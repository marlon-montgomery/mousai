!function(){"use strict";function t(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,n){if(!t)return;if("string"==typeof t)return e(t,n);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return e(t,n)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function n(t,e){return(n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function i(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var n,i=r(t);if(e){var o=r(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return a(this,n)}}function a(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function r(t){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function c(t,e,n){return e&&u(t.prototype,e),n&&u(t,n),t}(self.webpackChunkclient=self.webpackChunkclient||[]).push([[170],{56383:function(e,a,r){r.r(a),r.d(a,{BackstageModule:function(){return di}});var u=r(54364),l=r(47532),d=r(76491),p=r(71435),m=r(56297),g=r(2316),f=r(81371),h=r(1707),v=r(34673),b=r(76177),Z=r(21270),x=r(9141),y=r(56432),k=r(15515),_=r(94315),A=r(70781),q=r(52529),C=r(52781),T=r(91015),w=r(81134),O=r(80639),I=r(83720),P=r(79902),U=r(18293),M=r(33927),J=r(96185),Q=r(80221),F=r(20616),N=r(39820),Y=["searchInput"],$=["fakeInput"];function D(t,e){if(1&t&&(g.TgZ(0,"span"),g._UZ(1,"media-image",16),g._uU(2),g.qZA()),2&t){var n=e.ngIf;g.xp6(1),g.Q6J("media",n),g.xp6(1),g.hij(" ",n.name," ")}}function S(t,e){1&t&&(g.TgZ(0,"span",17),g._uU(1,"Select an artist"),g.qZA())}function L(t,e){if(1&t){var n=g.EpF();g.TgZ(0,"button",18),g.NdJ("click",function(){return g.CHM(n),g.oxw().clearSearchInput()}),g._UZ(1,"mat-icon",19),g.qZA()}}function E(t,e){if(1&t){var n=g.EpF();g.TgZ(0,"button",20),g.NdJ("click",function(){var t=g.CHM(n).$implicit;return g.oxw().selectArtist(t)}),g._UZ(1,"media-image",16),g.TgZ(2,"div",21),g.TgZ(3,"div",22),g._uU(4),g.qZA(),g.TgZ(5,"div",23),g._uU(6,"Artist"),g.qZA(),g.qZA(),g.qZA()}if(2&t){var i=e.$implicit;g.xp6(1),g.Q6J("media",i),g.xp6(3),g.Oqu(i.name)}}function z(t,e){1&t&&(g.TgZ(0,"div",24),g._uU(1,"No artists found."),g.qZA())}var B,G=((B=function(){function t(e){s(this,t),this.search=e,this.listAll=!1,this.isDisabled$=new d.X(!1),this.searchFormControl=new h.NI,this.loading$=new d.X(!1),this.artists$=new d.X([]),this.selectedArtist$=new d.X(null),this.searchedOnce=!1}return c(t,[{key:"ngOnInit",value:function(){this.bindToSearchControl()}},{key:"writeValue",value:function(t){this.selectedArtist$.next(t)}},{key:"registerOnChange",value:function(t){this.propagateChange=t}},{key:"registerOnTouched",value:function(){}},{key:"setDisabledState",value:function(t){this.isDisabled$.next(t)}},{key:"bindToSearchControl",value:function(){var t=this;this.searchFormControl.valueChanges.pipe((0,O.b)(150),(0,I.x)(),(0,P.w)(function(e){return t.searchArtists(e)}),(0,U.K)(function(){return(0,w.of)([])})).subscribe(function(e){t.searchedOnce=!0,t.artists$.next(e)})}},{key:"searchArtists",value:function(t){var e=this;return this.loading$.next(!0),this.search.suggestArtists({query:t,limit:7,listAll:this.listAll}).pipe((0,p.x)(function(){return e.loading$.next(!1)}),(0,M.U)(function(t){return t.artists}))}},{key:"onMenuOpened",value:function(){document.querySelector(".select-artist-control-menu").style.width=this.fakeInput.nativeElement.getBoundingClientRect().width+"px",this.searchedOnce||this.clearSearchInput()}},{key:"selectArtist",value:function(t){this.selectedArtist$.next(t),this.propagateChange(t)}},{key:"clearSearchInput",value:function(){this.searchFormControl.setValue("")}},{key:"onMenuClosed",value:function(){this.loading$.next(!1),this.clearSearchInput()}}]),t}()).\u0275fac=function(t){return new(t||B)(g.Y36(J.o))},B.\u0275cmp=g.Xpm({type:B,selectors:[["select-artist-control"]],viewQuery:function(t,e){var n;1&t&&(g.Gf(Y,5),g.Gf($,5)),2&t&&(g.iGM(n=g.CRH())&&(e.searchInput=n.first),g.iGM(n=g.CRH())&&(e.fakeInput=n.first))},hostAttrs:["tabindex","0"],inputs:{listAll:"listAll"},features:[g._Bn([{provide:h.JU,useExisting:B,multi:!0}])],decls:22,vars:20,consts:[[1,"fake-input",3,"matMenuTriggerFor","menuOpened","menuClosed"],["fakeInput",""],[4,"ngIf","ngIfElse"],["anyArtist",""],[1,"arrow-container"],[1,"arrow"],[1,"select-artist-control-menu"],["menu","matMenu"],[1,"input-container","search-input-container",3,"click"],[1,"search-input-wrapper"],["type","text","placeholder","Search...","mat-menu-item","","trans-placeholder","",3,"formControl"],["searchInput",""],["class","clear-search-input-button","mat-icon-button","",3,"click",4,"ngIf"],[1,"small",3,"isVisible"],["type","button","mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["mat-menu-item","","disabled","","trans","",4,"ngIf"],[1,"result-image",3,"media"],["trans",""],["mat-icon-button","",1,"clear-search-input-button",3,"click"],["svgIcon","close"],["type","button","mat-menu-item","",3,"click"],[1,"user-info"],[1,"name"],["trans","",1,"email"],["mat-menu-item","","disabled","","trans",""]],template:function(t,e){if(1&t&&(g.TgZ(0,"div",0,1),g.NdJ("menuOpened",function(){return e.onMenuOpened()})("menuClosed",function(){return e.onMenuClosed()}),g.ALo(2,"async"),g.YNc(3,D,3,2,"span",2),g.ALo(4,"async"),g.YNc(5,S,2,0,"ng-template",null,3,g.W1O),g.TgZ(7,"div",4),g._UZ(8,"div",5),g.qZA(),g.qZA(),g.TgZ(9,"mat-menu",6,7),g.TgZ(11,"div",8),g.NdJ("click",function(t){return t.stopPropagation()}),g.TgZ(12,"div",9),g._UZ(13,"input",10,11),g.YNc(15,L,2,0,"button",12),g._UZ(16,"loading-indicator",13),g.ALo(17,"async"),g.qZA(),g.qZA(),g.YNc(18,E,7,2,"button",14),g.ALo(19,"async"),g.YNc(20,z,2,0,"div",15),g.ALo(21,"async"),g.qZA()),2&t){var n=g.MAs(6),i=g.MAs(10);g.ekj("disabled",g.lcZ(2,10,e.isDisabled$)),g.Q6J("matMenuTriggerFor",i),g.xp6(3),g.Q6J("ngIf",g.lcZ(4,12,e.selectedArtist$))("ngIfElse",n),g.xp6(10),g.Q6J("formControl",e.searchFormControl),g.xp6(2),g.Q6J("ngIf",e.searchFormControl.value),g.xp6(1),g.Q6J("isVisible",g.lcZ(17,14,e.loading$)),g.xp6(2),g.Q6J("ngForOf",g.lcZ(19,16,e.artists$)),g.xp6(2),g.Q6J("ngIf",e.searchedOnce&&!g.lcZ(21,18,e.artists$).length)}},directives:[Q.p6,u.O5,Q.yF,h.Fj,Q.OP,k.P,h.JJ,h.oH,F.Q,u.sg,N.P,A.lW,q.Hw],pipes:[u.Ov],styles:["[_nghost-%COMP%]{display:block;min-width:280px;max-width:100%}.fake-input[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;cursor:pointer}.fake-input.disabled[_ngcontent-%COMP%]{pointer-events:none;opacity:.7}.result-image[_ngcontent-%COMP%]{display:inline-block;margin-right:5px;width:25px;height:25px;border-radius:4px;vertical-align:middle}.placeholder[_ngcontent-%COMP%]{opacity:.6}.arrow-container[_ngcontent-%COMP%]{height:100%;position:absolute;top:1px;right:1px;width:20px}.arrow[_ngcontent-%COMP%]{position:absolute;border-color:#000 transparent transparent transparent;border-style:solid;border-width:5px 4px 0 4px;height:0;width:0;left:50%;top:50%;margin-left:-4px;margin-top:-2px}  .select-artist-control-menu{max-width:none!important}.mat-menu-item[_ngcontent-%COMP%]:first-of-type{border-top:1px solid var(--be-divider-default)}.search-input-container[_ngcontent-%COMP%]{padding:7px 15px 15px}.search-input-wrapper[_ngcontent-%COMP%]{position:relative}.clear-search-input-button[_ngcontent-%COMP%]{position:absolute;top:4px;right:0;color:var(--be-secondary-text)}.mat-menu-item[_ngcontent-%COMP%]:not(input){display:flex;align-items:center;height:65px;line-height:65px}.mat-menu-item[_ngcontent-%COMP%]:not(input).selected{background-color:var(--be-accent-emphasis)}.mat-menu-item[_ngcontent-%COMP%]:not(input)   .result-image[_ngcontent-%COMP%]{width:45px;height:45px;margin-right:15px;border-radius:50%}.mat-menu-item[_ngcontent-%COMP%]:not(input)   .name[_ngcontent-%COMP%]{text-transform:capitalize;overflow:hidden;text-overflow:ellipsis}.mat-menu-item[_ngcontent-%COMP%]:not(input)   .email[_ngcontent-%COMP%]{color:var(--be-secondary-text);font-size:1.3rem;overflow:hidden;text-overflow:ellipsis}.user-info[_ngcontent-%COMP%]{line-height:normal;line-height:initial}.any-user-info[_ngcontent-%COMP%]{line-height:35px}loading-indicator[_ngcontent-%COMP%]{position:absolute;top:12px;right:40px}"],changeDetection:0}),B),V=r(52644);function j(t,e){if(1&t&&(g.TgZ(0,"div",32),g._uU(1),g.qZA()),2&t){var n=g.oxw(3).ngIf;g.xp6(1),g.Oqu(n.artist_id)}}function H(t,e){if(1&t&&(g.TgZ(0,"div",7),g.TgZ(1,"label",30),g._uU(2,"Select Artist"),g.qZA(),g._UZ(3,"select-artist-control",31),g.YNc(4,j,2,1,"div",10),g.qZA()),2&t){var n=g.oxw(2).ngIf;g.xp6(3),g.Q6J("listAll",!0),g.xp6(1),g.Q6J("ngIf",n.artist_id)}}function R(t,e){if(1&t&&(g.TgZ(0,"div",32),g._uU(1),g.qZA()),2&t){var n=g.oxw(3).ngIf;g.xp6(1),g.Oqu(n.name)}}function X(t,e){if(1&t&&(g.TgZ(0,"div",7),g.TgZ(1,"label",33),g._uU(2,"Your artist name"),g.qZA(),g._UZ(3,"input",34),g.YNc(4,R,2,1,"div",10),g.qZA()),2&t){var n=g.oxw(2).ngIf;g.xp6(4),g.Q6J("ngIf",n.name)}}function W(t,e){if(1&t&&(g.TgZ(0,"div",32),g._uU(1),g.qZA()),2&t){var n=g.oxw(2).ngIf;g.xp6(1),g.Oqu(n.first_name)}}function K(t,e){if(1&t&&(g.TgZ(0,"div",32),g._uU(1),g.qZA()),2&t){var n=g.oxw(2).ngIf;g.xp6(1),g.Oqu(n.last_name)}}function tt(t,e){if(1&t&&(g.TgZ(0,"div",32),g._uU(1),g.qZA()),2&t){var n=g.oxw(3).ngIf;g.xp6(1),g.Oqu(n.role)}}function et(t,e){if(1&t&&(g.TgZ(0,"div",7),g.TgZ(1,"label",35),g._uU(2,"Role"),g.qZA(),g.TgZ(3,"select",36),g.TgZ(4,"option",37),g._uU(5,"Select role"),g.qZA(),g.TgZ(6,"option",38),g._uU(7,"Artist"),g.qZA(),g.TgZ(8,"option",39),g._uU(9,"Agent"),g.qZA(),g.TgZ(10,"option",40),g._uU(11,"Composer"),g.qZA(),g.TgZ(12,"option",41),g._uU(13,"Label"),g.qZA(),g.TgZ(14,"option",42),g._uU(15,"Manager"),g.qZA(),g.TgZ(16,"option",43),g._uU(17,"Musician"),g.qZA(),g.TgZ(18,"option",44),g._uU(19,"Producer"),g.qZA(),g.TgZ(20,"option",45),g._uU(21,"Publisher"),g.qZA(),g.TgZ(22,"option",46),g._uU(23,"Songwriter"),g.qZA(),g.qZA(),g.YNc(24,tt,2,1,"div",10),g.qZA()),2&t){var n=g.oxw(2).ngIf;g.xp6(4),g.Q6J("value",null),g.xp6(20),g.Q6J("ngIf",n.role)}}function nt(t,e){if(1&t&&(g.TgZ(0,"div",32),g._uU(1),g.qZA()),2&t){var n=g.oxw(2).ngIf;g.xp6(1),g.Oqu(n.company)}}function it(t,e){if(1&t){var n=g.EpF();g.TgZ(0,"div",47),g._UZ(1,"img",48),g.TgZ(2,"div",49),g.TgZ(3,"div",50),g._uU(4),g.qZA(),g.TgZ(5,"a",51),g._uU(6),g.qZA(),g.qZA(),g.TgZ(7,"button",52),g.NdJ("click",function(){var t=g.CHM(n).$implicit;return g.oxw(3).removeSocialProfile(t.key)}),g._UZ(8,"mat-icon",53),g.qZA(),g.qZA()}if(2&t){var i=e.$implicit;g.xp6(1),g.Q6J("src",i.value.avatar,g.LSH),g.xp6(3),g.hij("",i.key," Profile"),g.xp6(1),g.Q6J("href",i.value.profileUrl,g.LSH),g.xp6(1),g.Oqu(i.value.profileUrl)}}function at(t,e){if(1&t){var n=g.EpF();g.TgZ(0,"div",54),g._UZ(1,"mat-icon",55),g.TgZ(2,"div",49),g.TgZ(3,"div",50),g._uU(4,"Passport Scan"),g.qZA(),g.TgZ(5,"div"),g._uU(6),g.ALo(7,"formattedFileSize"),g.qZA(),g.qZA(),g.TgZ(8,"button",52),g.NdJ("click",function(){return g.CHM(n),g.oxw(3).removePassportUpload()}),g._UZ(9,"mat-icon",53),g.qZA(),g.qZA()}if(2&t){var i=e.ngIf;g.xp6(6),g.AsE("",i.name," (",g.lcZ(7,2,i.file_size),")")}}var rt=function(){return["image/*"]},ot=function(t){return{types:t}};function st(t,e){if(1&t){var n=g.EpF();g.ynx(0),g._UZ(1,"upload-image-control",4),g.YNc(2,H,5,2,"div",5),g.YNc(3,X,5,1,"div",5),g.TgZ(4,"div",6),g.TgZ(5,"div",7),g.TgZ(6,"label",8),g._uU(7,"First name"),g.qZA(),g._UZ(8,"input",9),g.YNc(9,W,2,1,"div",10),g.qZA(),g.TgZ(10,"div",7),g.TgZ(11,"label",11),g._uU(12,"Last name"),g.qZA(),g._UZ(13,"input",12),g.YNc(14,K,2,1,"div",10),g.qZA(),g.qZA(),g.YNc(15,et,25,2,"div",5),g.TgZ(16,"div",7),g.TgZ(17,"label",13),g._uU(18,"Company (optional)"),g.qZA(),g._UZ(19,"input",14),g.YNc(20,nt,2,1,"div",10),g.qZA(),g.TgZ(21,"div",15),g.TgZ(22,"div",16),g._uU(23,"Speed up the process by connecting artist social media accounts or uploading your passport scan."),g.qZA(),g.TgZ(24,"div",17),g.TgZ(25,"button",18),g.NdJ("click",function(){return g.CHM(n),g.oxw(2).retrieveSocialProfile("twitter")}),g._UZ(26,"mat-icon",19),g.TgZ(27,"span",0),g._uU(28,"Connect to Twitter"),g.qZA(),g.qZA(),g.TgZ(29,"button",20),g.NdJ("click",function(){return g.CHM(n),g.oxw(2).retrieveSocialProfile("facebook")}),g._UZ(30,"mat-icon",21),g.TgZ(31,"span",0),g._uU(32,"Connect to Facebook"),g.qZA(),g.qZA(),g.TgZ(33,"button",22),g.NdJ("filesSelected",function(t){return g.CHM(n),g.oxw(2).uploadPassportScan(t)}),g._UZ(34,"mat-icon",23),g.TgZ(35,"span",0),g._uU(36,"Upload Passport Scan"),g.qZA(),g.qZA(),g.qZA(),g.TgZ(37,"div",24),g.YNc(38,it,9,4,"div",25),g.ALo(39,"keyvalue"),g.ALo(40,"async"),g.YNc(41,at,10,4,"div",26),g.ALo(42,"async"),g._UZ(43,"upload-progress-bar"),g.qZA(),g.qZA(),g.TgZ(44,"div",27),g.TgZ(45,"a",28),g._uU(46,"Go Back"),g.qZA(),g.TgZ(47,"button",29),g.ALo(48,"async"),g._uU(49,"Submit Request"),g.qZA(),g.qZA(),g.BQk()}if(2&t){var i=e.ngIf,a=g.oxw().ngIf,r=g.oxw();g.xp6(1),g.Q6J("compact",!0),g.xp6(1),g.Q6J("ngIf","become-artist"!==i),g.xp6(1),g.Q6J("ngIf","become-artist"===i),g.xp6(6),g.Q6J("ngIf",a.first_name),g.xp6(5),g.Q6J("ngIf",a.last_name),g.xp6(1),g.Q6J("ngIf","claim-artist"===i),g.xp6(5),g.Q6J("ngIf",a.company),g.xp6(13),g.Q6J("uploadButton",g.VKq(20,ot,g.DdM(19,rt))),g.xp6(5),g.Q6J("ngForOf",g.lcZ(39,11,g.lcZ(40,13,r.socialProfiles$))),g.xp6(3),g.Q6J("ngIf",g.lcZ(42,15,r.uploadedPassportEntry$)),g.xp6(6),g.Q6J("disabled",g.lcZ(48,17,r.loading$))}}function ut(t,e){if(1&t){var n=g.EpF();g.TgZ(0,"form",2),g.NdJ("ngSubmit",function(){return g.CHM(n),g.oxw().requestAccess()}),g.YNc(1,st,50,22,"ng-container",3),g.ALo(2,"async"),g.qZA()}if(2&t){var i=g.oxw();g.Q6J("formGroup",i.form),g.xp6(1),g.Q6J("ngIf",g.lcZ(2,2,i.requestType$))}}var ct=function(){var t=function(){function t(e,n,i,a,r,o,u,c,l){var p;s(this,t),this.backstage=e,this.fb=n,this.settings=i,this.currentUser=a,this.socialAuth=r,this.uploadQueue=o,this.imageValidator=u,this.router=c,this.route=l,this.uploadedPassportEntry$=new d.X(null),this.socialProfiles$=new d.X(null),this.errors$=new d.X({}),this.loading$=new d.X(!1),this.requestType$=new d.X(null),this.form=this.fb.group({artist:[],artist_name:[this.currentUser.get("display_name")],image:[(null===(p=this.currentUser.primaryArtist())||void 0===p?void 0:p.image_small)||this.currentUser.get("avatar")],first_name:[this.currentUser.get("first_name")],last_name:[this.currentUser.get("last_name")],role:[],company:[""]}),this.requestType$.next(this.route.routeConfig.path.replace("requests/","")),this.requestType$.value===m.n.verifyArtist&&(this.form.get("artist").setValue(this.currentUser.primaryArtist()),this.form.get("artist").disable()),this.requestType$.value===m.n.becomeArtist&&(this.form.get("artist").setValue(this.currentUser.artistPlaceholder()),this.form.get("artist").disable()),this.requestType$.value!==m.n.claimArtist&&this.form.get("role").setValue("artist"),this.requestType$.value!==m.n.becomeArtist&&this.form.get("image").disable()}return c(t,[{key:"requestAccess",value:function(){var t,e,n=this;this.loading$.next(!0);var i={artist_name:this.form.value.artist_name,artist_id:null===(t=this.form.value.artist)||void 0===t?void 0:t.id,type:this.requestType$.value,data:Object.assign(Object.assign({},this.form.value),{passportScanEntryId:null===(e=this.uploadedPassportEntry$.value)||void 0===e?void 0:e.id,socialProfiles:this.socialProfiles$.value})};this.backstage.submitRequest(i).pipe((0,p.x)(function(){return n.loading$.next(!1)})).subscribe(function(t){n.router.navigate(["/backstage/requests",t.request.id,"request-submitted"],{replaceUrl:!0})},function(t){return n.errors$.next(t.errors)})}},{key:"retrieveSocialProfile",value:function(t){var e=this;this.socialAuth.retrieveProfile(t).then(function(n){e.socialProfiles$.next(Object.assign(Object.assign({},e.socialProfiles$.value),o({},t,n)))})}},{key:"uploadPassportScan",value:function(t){var e=this;this.uploadQueue.start(t,{uri:"uploads/images",httpParams:{diskPrefix:"test",disk:"private"},validator:this.imageValidator}).subscribe(function(t){e.uploadedPassportEntry$.next(t.fileEntry)})}},{key:"removePassportUpload",value:function(){this.uploadedPassportEntry$.next(null)}},{key:"removeSocialProfile",value:function(t){var e=Object.assign({},this.socialProfiles$.value);delete e[t],this.socialProfiles$.next(e)}}]),t}();return t.\u0275fac=function(e){return new(e||t)(g.Y36(f.T),g.Y36(h.qu),g.Y36(v.Z),g.Y36(b.z),g.Y36(Z.x),g.Y36(x.A),g.Y36(y.v),g.Y36(l.F0),g.Y36(l.gz))},t.\u0275cmp=g.Xpm({type:t,selectors:[["backstage-request-form"]],decls:4,vars:3,consts:[["trans",""],["ngNativeValidate","","class","many-inputs",3,"formGroup","ngSubmit",4,"ngIf"],["ngNativeValidate","",1,"many-inputs",3,"formGroup","ngSubmit"],[4,"ngIf"],["formControlName","image",3,"compact"],["class","input-container",4,"ngIf"],[1,"inline-inputs-container","many-inputs"],[1,"input-container"],["for","backstage-first-name","trans",""],["type","text","id","backstage-first-name","formControlName","first_name","required",""],["class","error",4,"ngIf"],["for","backstage-last-name","trans",""],["type","text","id","backstage-last-name","formControlName","last_name","required",""],["for","backstage-company","trans",""],["type","text","id","backstage-company","formControlName","company"],[1,"speed-up-container"],["trans","",1,"speed-up-title"],[1,"speed-up-buttons"],["type","button","mat-flat-button","","color","accent",1,"twitter-btn","speed-up-button",3,"click"],["svgIcon","twitter",1,"social-icon"],["type","button","mat-flat-button","","color","accent",1,"facebook-btn","speed-up-button",3,"click"],["svgIcon","facebook",1,"social-icon"],["type","button","mat-flat-button","","color","accent",1,"passport-btn","speed-up-button",3,"uploadButton","filesSelected"],["svgIcon","document-scanner",1,"social-icon"],[1,"attached-verifications"],["class","facebook-profile verification",4,"ngFor","ngForOf"],["class","passport-attachment verification",4,"ngIf"],[1,"backstage-action-buttons"],["type","button","routerLink","/backstage/requests","mat-raised-button","","trans","",1,"backstage-action-button"],["type","submit","mat-raised-button","","color","accent","trans","",1,"backstage-action-button",3,"disabled"],["for","backstage-artist","trans",""],["id","backstage-artist","formControlName","artist",3,"listAll"],[1,"error"],["for","backstage-name","trans",""],["type","text","id","backstage-name","formControlName","artist_name","required",""],["for","backstage-role","trans",""],["type","text","id","backstage-role","formControlName","role","required",""],["disabled","","trans","",3,"value"],["value","artist","trans",""],["value","agent","trans",""],["value","composer","trans",""],["value","label","trans",""],["value","manager","trans",""],["value","musician","trans",""],["value","producer","trans",""],["value","publisher","trans",""],["value","songwriter","trans",""],[1,"facebook-profile","verification"],["alt","",1,"verification-img",3,"src"],[1,"verification-details"],["trans","",1,"verification-name"],["target","_blank",1,"verification-url",3,"href"],["type","button","mat-icon-button","",1,"remove-verification",3,"click"],["svgIcon","close"],[1,"passport-attachment","verification"],["svgIcon","document-scanner",1,"verification-img"]],template:function(t,e){1&t&&(g.TgZ(0,"h1",0),g._uU(1,"Tell us about yourself"),g.qZA(),g.YNc(2,ut,3,4,"form",1),g.ALo(3,"async")),2&t&&(g.xp6(2),g.Q6J("ngIf",g.lcZ(3,1,e.errors$)))},directives:[k.P,u.O5,h.JL,h.sg,_.V,h.JJ,h.u,h.Fj,h.Q7,A.lW,q.Hw,C.c,u.sg,T.o,l.yS,A.zs,G,h.EJ,h.YN,h.Kr],pipes:[u.Ov,u.Nd,V.y],styles:["[_nghost-%COMP%]{display:block;max-width:800px;margin:auto}h1[_ngcontent-%COMP%]{text-align:center}upload-image-control[_ngcontent-%COMP%]{margin:15px auto;width:160px;height:160px;border-radius:50%}.input-container[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .input-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .input-container[_ngcontent-%COMP%]     .fake-input{height:55px}.speed-up-container[_ngcontent-%COMP%]{padding:15px 0 30px;border-bottom:1px solid var(--be-divider-lighter)}.speed-up-title[_ngcontent-%COMP%]{font-size:1.5rem;margin-bottom:15px}.speed-up-button[_ngcontent-%COMP%]{margin-right:10px}.facebook-btn[_ngcontent-%COMP%]{background:#3b5998}.twitter-btn[_ngcontent-%COMP%]{background:#1da1f2}.social-icon[_ngcontent-%COMP%]{margin-right:5px}upload-progress-bar[_ngcontent-%COMP%]{position:absolute;bottom:0;width:100%}.attached-verifications[_ngcontent-%COMP%]:not(:empty){position:relative}.attached-verifications[_ngcontent-%COMP%]:not(:empty):not(:empty){margin-top:20px}.verification[_ngcontent-%COMP%]{display:flex;align-items:center;border:1px solid var(--be-divider-default);border-radius:4px;padding:10px;margin-bottom:10px}.verification-details[_ngcontent-%COMP%]{overflow:hidden}.verification-url[_ngcontent-%COMP%]{display:block;overflow:hidden;text-overflow:ellipsis}.verification-img[_ngcontent-%COMP%]{height:35px;width:35px;-o-object-fit:cover;object-fit:cover;flex-shrink:0;margin-right:10px}.verification-name[_ngcontent-%COMP%]{font-size:1.3rem;color:var(--be-secondary-text);text-transform:capitalize}.remove-verification[_ngcontent-%COMP%]{margin-left:auto}"],changeDetection:0}),t}(),lt=function(){var t=function t(){s(this,t)};return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=g.Xpm({type:t,selectors:[["backstage-request-submitted"]],decls:14,vars:0,consts:[[1,"text-align-center"],["svgIcon","check",1,"check-icon"],["trans",""],[1,"backstage-action-buttons"],["routerLink","/","mat-flat-button","","color","accent","trans","",1,"backstage-action-button"]],template:function(t,e){1&t&&(g.TgZ(0,"div",0),g._UZ(1,"mat-icon",1),g.qZA(),g.TgZ(2,"h1",2),g._uU(3,"We've got your request"),g.qZA(),g.TgZ(4,"ul"),g.TgZ(5,"li"),g._uU(6,"Our support team will review it and send you an email within 3 days!"),g.qZA(),g.TgZ(7,"li"),g._uU(8,"Don't submit another request until you hear from us."),g.qZA(),g.TgZ(9,"li"),g._uU(10,"If this artist profile is already claimed, ask an admin on your team to invite you."),g.qZA(),g.qZA(),g.TgZ(11,"div",3),g.TgZ(12,"a",4),g._uU(13,"Got It"),g.qZA(),g.qZA())},directives:[q.Hw,k.P,l.yS,A.zs],styles:["[_nghost-%COMP%]{display:block;margin:auto;max-width:800px}.check-icon[_ngcontent-%COMP%]{width:64px;height:64px;line-height:64px;margin-bottom:25px}h1[_ngcontent-%COMP%]{text-align:center;margin-bottom:25px}ul[_ngcontent-%COMP%]{font-size:1.6rem;line-height:28px}.text-align-center[_ngcontent-%COMP%]{text-align:center}.action-buttons[_ngcontent-%COMP%]{margin-top:70px;justify-content:center}.backstage-action-buttons[_ngcontent-%COMP%]{justify-content:center}"],changeDetection:0}),t}();function dt(t,e){1&t&&(g.ynx(0),g._uU(1,"Get verified"),g.BQk())}function pt(t,e){1&t&&(g.ynx(0),g._uU(1,"Become an artist"),g.BQk())}var mt=function(t){return{sitename:t}},gt=function(t){return[t]},ft=function(){var t=function t(e,n){s(this,t),this.settings=e,this.currentUser=n,this.currentUserIsArtist=!1,this.currentUserIsArtist=!!this.currentUser.primaryArtist()};return t.\u0275fac=function(e){return new(e||t)(g.Y36(v.Z),g.Y36(b.z))},t.\u0275cmp=g.Xpm({type:t,selectors:[["backstage-type-selector"]],decls:14,vars:8,consts:[["trans","",3,"transValues"],["trans",""],[1,"claim-row"],[1,"claim-col",3,"routerLink"],["trans","",1,"title"],[4,"ngIf"],["src","client/assets/images/backstage/claim-artist.jpg","alt",""],["routerLink","claim-artist",1,"claim-col"],["src","client/assets/images/backstage/claim-label.jpg","alt",""]],template:function(t,e){1&t&&(g.TgZ(0,"h1",0),g._uU(1,"Get Access to :sitename for Artists"),g.qZA(),g.TgZ(2,"h2",1),g._uU(3,"First, select the type of your request."),g.qZA(),g.TgZ(4,"div",2),g.TgZ(5,"a",3),g.TgZ(6,"div",4),g.YNc(7,dt,2,0,"ng-container",5),g.YNc(8,pt,2,0,"ng-container",5),g.qZA(),g._UZ(9,"img",6),g.qZA(),g.TgZ(10,"a",7),g.TgZ(11,"div",4),g._uU(12,"Claim existing artist"),g.qZA(),g._UZ(13,"img",8),g.qZA(),g.qZA()),2&t&&(g.Q6J("transValues",g.VKq(4,mt,e.settings.get("branding.site_name"))),g.xp6(5),g.Q6J("routerLink",g.VKq(6,gt,e.currentUserIsArtist?"verify-artist":"become-artist")),g.xp6(2),g.Q6J("ngIf",e.currentUserIsArtist),g.xp6(1),g.Q6J("ngIf",!e.currentUserIsArtist))},directives:[k.P,l.yS,u.O5],styles:["[_nghost-%COMP%]{display:block;max-width:800px;margin:auto}.claim-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-top:25px}.claim-col[_ngcontent-%COMP%]{display:flex;align-items:center;flex-direction:column;border:2px solid var(--be-divider-default);border-radius:10px;width:calc(50% - 30px);padding:35px 25px;transition:box-shadow .2s ease 0s;color:inherit}.claim-col[_ngcontent-%COMP%]:hover{box-shadow:0 7px 9px -4px rgba(0,0,0,.2),0 14px 21px 2px rgba(0,0,0,.141),0 5px 26px 4px rgba(0,0,0,.122);background:var(--be-background)}.claim-col[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:132px;height:132px;border-radius:50%;-o-object-fit:cover;object-fit:cover}.claim-col[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:1.8rem;font-weight:500;margin-bottom:10px}"],changeDetection:0}),t}(),ht=r(69407),vt=r(44434),bt=r(35718),Zt=r(60983),xt=r(9348),yt=r(44666),kt=r(85408),_t=r(3786),At=r(8208),qt=r(66142),Ct=r(15381),Tt=r(10685),wt=r(24688),Ot=r(90436),It=r(70236),Pt=r(1303),Ut=r(50298),Mt=r(76403),Jt=r(63297),Qt=function(t){return{artist:t}};function Ft(t,e){if(1&t&&(g.TgZ(0,"a",13),g._uU(1,"New Album"),g.qZA()),2&t){var n=g.oxw();g.Q6J("routerLink",n.urls.createAlbum(n.insideAdmin))("queryParams",g.VKq(3,Qt,n.encodedArtist))("disabled",!n.artist)}}function Nt(t,e){1&t&&(g.TgZ(0,"p",14),g._UZ(1,"mat-icon",15),g.TgZ(2,"span",16),g._uU(3,"Save artist first to enable album creation."),g.qZA(),g.qZA())}function Yt(t,e){if(1&t){var n=g.EpF();g.TgZ(0,"button",26),g.NdJ("click",function(){g.CHM(n);var t=g.oxw().$implicit;return g.oxw().maybeDeleteAlbum(t)}),g.ALo(1,"trans"),g._UZ(2,"mat-icon",27),g.qZA()}2&t&&g.Q6J("matTooltip",g.lcZ(1,1,"Delete album"))}function $t(t,e){if(1&t&&(g.TgZ(0,"tr"),g.TgZ(1,"td"),g.TgZ(2,"div",17),g._UZ(3,"media-image",18),g.TgZ(4,"span"),g._uU(5),g.qZA(),g.qZA(),g.qZA(),g.TgZ(6,"td",19),g._uU(7),g.qZA(),g.TgZ(8,"td",20),g._uU(9),g.qZA(),g.TgZ(10,"td",21),g._uU(11),g.qZA(),g.TgZ(12,"td",22),g.TgZ(13,"a",23),g.ALo(14,"trans"),g._UZ(15,"mat-icon",24),g.qZA(),g.YNc(16,Yt,3,3,"button",25),g.qZA(),g.qZA()),2&t){var n=e.$implicit,i=g.oxw();g.xp6(3),g.Q6J("media",n),g.xp6(2),g.Oqu(n.name),g.xp6(2),g.Oqu(n.release_date?n.release_date:"\u2013"),g.xp6(2),g.Oqu(n.views),g.xp6(2),g.Oqu(n.tracks_count?n.tracks_count:"\u2013"),g.xp6(2),g.Q6J("routerLink",i.urls.editAlbum(n,i.insideAdmin))("queryParams",g.VKq(11,Qt,i.encodedArtist))("matTooltip",g.lcZ(14,9,"Edit album")),g.xp6(3),g.Q6J("ngIf",i.currentUser.hasPermission("albums.delete"))}}function Dt(t,e){1&t&&(g.TgZ(0,"no-results-message",28),g.TgZ(1,"span",29),g._uU(2,"This artist has no albums yet"),g.qZA(),g.qZA())}var St=function(){var t=function(){function t(e,n,i,a,r,o,u){s(this,t),this.modal=e,this.albumsApi=n,this.currentUser=i,this.images=a,this.datatable=r,this.urls=o,this.router=u,this.albums=[],this.albums$=this.datatable.data$}return c(t,[{key:"ngOnChanges",value:function(t){this.artist&&(this.encodedArtist=btoa(JSON.stringify({id:this.artist.id,name:this.artist.name,image_small:this.artist.image_small})))}},{key:"ngOnInit",value:function(){this.insideAdmin=this.router.url.includes("admin"),this.datatable.init({initialData:this.albums?this.albums:[]})}},{key:"maybeDeleteAlbum",value:function(t){var e=this;this.modal.show(At.z,{title:"Delete Album",body:"Are you sure you want to delete this album?",ok:"Delete"}).beforeClosed().subscribe(function(n){return(0,_t.mG)(e,void 0,void 0,regeneratorRuntime.mark(function e(){var i=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:!n||this.albumsApi.delete([t.id]).subscribe(function(){i.datatable.data=i.datatable.data.filter(function(e){return e.id!==t.id})});case 1:case"end":return e.stop()}},e,this)}))})}}]),t}();return t.\u0275fac=function(e){return new(e||t)(g.Y36(Ct.u),g.Y36(Tt.R),g.Y36(wt.I),g.Y36(Ot.v),g.Y36(qt.x),g.Y36(Zt.J),g.Y36(l.F0))},t.\u0275cmp=g.Xpm({type:t,selectors:[["artist-albums-table"]],inputs:{artist:"artist",albums:"albums"},features:[g._Bn([qt.x]),g.TTD],decls:22,vars:6,consts:[[1,"datatable"],["pluralResourceName","albums"],["leftContent",""],[1,"new-album-container"],["mat-raised-button","","color","accent","trans","",3,"routerLink","queryParams","disabled",4,"ngIf"],["class","save-message",4,"ngIf"],[1,"material-table"],["table-sort-header","name","trans",""],["table-sort-header","","trans",""],["table-sort-header","views","trans",""],["table-sort-header","tracks_count","trans",""],[4,"ngFor","ngForOf"],["svgImage","music.svg",4,"ngIf"],["mat-raised-button","","color","accent","trans","",3,"routerLink","queryParams","disabled"],[1,"save-message"],["svgIcon","warning"],["trans",""],[1,"column-with-image"],["default","album",3,"media"],["data-label","Release Date"],["data-label","Views"],["data-label","Number of Tracks"],[1,"edit-column"],["mat-icon-button","",3,"routerLink","queryParams","matTooltip"],["svgIcon","edit"],["mat-icon-button","","trans","",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","trans","",3,"matTooltip","click"],["svgIcon","delete"],["svgImage","music.svg"],["primary-text","","trans",""]],template:function(t,e){1&t&&(g.TgZ(0,"div",0),g.TgZ(1,"datatable-header",1),g.ynx(2,2),g.TgZ(3,"div",3),g.YNc(4,Ft,2,5,"a",4),g.YNc(5,Nt,4,0,"p",5),g.qZA(),g.BQk(),g.qZA(),g.TgZ(6,"table",6),g.TgZ(7,"thead"),g.TgZ(8,"tr"),g.TgZ(9,"th",7),g._uU(10,"Album"),g.qZA(),g.TgZ(11,"th",8),g._uU(12,"Release Date"),g.qZA(),g.TgZ(13,"th",9),g._uU(14,"Views"),g.qZA(),g.TgZ(15,"th",10),g._uU(16,"Number Of Tracks"),g.qZA(),g._UZ(17,"th"),g.qZA(),g.qZA(),g.TgZ(18,"tbody"),g.YNc(19,$t,17,13,"tr",11),g.ALo(20,"async"),g.qZA(),g.qZA(),g.YNc(21,Dt,3,0,"no-results-message",12),g.qZA()),2&t&&(g.xp6(4),g.Q6J("ngIf",e.currentUser.hasPermission("music.create")),g.xp6(1),g.Q6J("ngIf",!e.artist),g.xp6(14),g.Q6J("ngForOf",g.lcZ(20,4,e.albums$)),g.xp6(2),g.Q6J("ngIf",!e.datatable.data.length))},directives:[It.G,u.O5,Pt.p,k.P,u.sg,A.zs,l.yS,q.Hw,N.P,Ut.gM,A.lW,Mt.U],pipes:[u.Ov,Jt.R],styles:["artist-albums-table{display:block}artist-albums-table .new-album-container{display:flex;align-items:center}artist-albums-table .no-results-message{margin-top:35px}artist-albums-table .save-message{color:var(--be-secondary-text);font-size:1.3rem;margin-left:25px}artist-albums-table .save-message .mat-icon{vertical-align:middle;margin-right:5px;width:18px;height:18px;line-height:18px}\n"],encapsulation:2}),t}(),Lt=r(32080);function Et(t,e){1&t&&(g.TgZ(0,"button",28),g._uU(1,"Update"),g.qZA())}function zt(t,e){1&t&&(g.TgZ(0,"button",28),g._uU(1,"Create"),g.qZA())}function Bt(t,e){if(1&t&&(g.TgZ(0,"div",29),g._uU(1),g.qZA()),2&t){var n=g.oxw();g.xp6(1),g.Oqu(n.errors.name)}}function Gt(t,e){if(1&t&&(g.TgZ(0,"div",29),g._uU(1),g.qZA()),2&t){var n=g.oxw();g.xp6(1),g.Oqu(n.errors.genres)}}function Vt(t,e){1&t&&(g.TgZ(0,"div",9),g.TgZ(1,"label",33),g._uU(2,"Spotify ID"),g.qZA(),g._UZ(3,"input",34),g.qZA())}function jt(t,e){if(1&t&&(g.TgZ(0,"div",29),g._uU(1),g.qZA()),2&t){var n=g.oxw(2);g.xp6(1),g.Oqu(n.errors.verified)}}function Ht(t,e){if(1&t&&(g.ynx(0),g.YNc(1,Vt,4,0,"div",30),g.TgZ(2,"div",31),g.TgZ(3,"mat-slide-toggle",32),g._uU(4,"Verified"),g.qZA(),g.YNc(5,jt,2,1,"div",12),g.qZA(),g.BQk()),2&t){var n=g.oxw();g.xp6(1),g.Q6J("ngIf",n.settings.get("spotify_is_setup")),g.xp6(4),g.Q6J("ngIf",n.errors.verified)}}var Rt=function(){return{diskPrefix:"bio"}},Xt=function(t){return{httpParams:t}};function Wt(t,e){if(1&t){var n=g.EpF();g.TgZ(0,"upload-image-control",35),g.NdJ("fileDeleted",function(){var t=g.CHM(n).index;return g.oxw().removeProfileImage(t)}),g.qZA()}if(2&t){var i=e.$implicit;g.Q6J("formControlName",e.index)("uploadConfig",g.VKq(4,Xt,g.DdM(3,Rt)))("buttonText",i.value?"Replace Image":"Upload Image")}}var Kt=function(){var t=function(){function t(e,n,i,a,r,o,u,c,l,d){var p=this;s(this,t),this.settings=e,this.uploadQueue=n,this.artists=i,this.route=a,this.toast=r,this.router=o,this.fb=u,this.cd=c,this.search=l,this.urls=d,this.insideAdmin=!1,this.errors={},this.albums=[],this.form=this.fb.group({name:[""],verified:[""],image_small:[""],spotify_id:[""],genres:[[]],description:[""],country:[""],city:[""],profile_images:this.fb.array([]),links:[[]]}),this.suggestGenreFn=function(t){return p.search.media(t,{types:[ht.J],limit:5}).pipe((0,M.U)(function(t){return t.results.genres.map(function(t){return t.name})}))}}return c(t,[{key:"ngOnInit",value:function(){this.bindToRouteData(),this.insideAdmin=this.router.url.includes("admin")}},{key:"createOrUpdate",value:function(){this.artist?this.update():this.create()}},{key:"create",value:function(){var t=this;return this.artists.create(this.form.value).subscribe(function(e){t.form.markAsPristine(),t.artist=e.artist,t.toast.open("Artist created."),t.router.navigate(t.urls.editArtist(t.artist.id,!0),{replaceUrl:!0}),t.errors={}},function(e){t.errors=e.errors,t.cd.detectChanges()})}},{key:"update",value:function(){var t=this;return this.artists.update(this.artist.id,this.form.value).subscribe(function(){t.form.markAsPristine(),t.toast.open("Artist updated."),t.router.navigate(["/admin/artists"])},function(e){t.errors=e.errors,t.cd.detectChanges()})}},{key:"profileImagesArray",value:function(){return this.form.get("profile_images")}},{key:"bindToRouteData",value:function(){var t=this;this.route.data.subscribe(function(e){var n,i,a;e.api&&(t.artist=e.api.artist,t.albums=e.api.albums,t.form.patchValue({name:e.api.artist.name,verified:e.api.artist.verified,image_small:e.api.artist.image_small,spotify_id:e.api.artist.spotify_id,genres:(e.api.artist.genres||[]).map(function(t){return t.name}),description:null===(n=e.api.artist.profile)||void 0===n?void 0:n.description,country:null===(i=e.api.artist.profile)||void 0===i?void 0:i.country,city:null===(a=e.api.artist.profile)||void 0===a?void 0:a.city,profile_images:[],links:e.api.artist.links}),(e.api.artist.profile_images||[]).forEach(function(e){t.addProfileImage(e.url)}))}),this.addProfileImage()}},{key:"addProfileImage",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.profileImagesArray().push(new h.NI(t))}},{key:"removeProfileImage",value:function(t){this.profileImagesArray().removeAt(t)}},{key:"canDeactivate",value:function(){return!this.form.dirty}}]),t}();return t.\u0275fac=function(e){return new(e||t)(g.Y36(v.Z),g.Y36(x.A),g.Y36(vt.c),g.Y36(l.gz),g.Y36(bt.F),g.Y36(l.F0),g.Y36(h.qu),g.Y36(g.sBO),g.Y36(J.o),g.Y36(Zt.J))},t.\u0275cmp=g.Xpm({type:t,selectors:[["crupdate-artist-page"]],features:[g._Bn([x.A])],decls:46,vars:20,consts:[[1,"material-panel"],["ngNativeValidate","",1,"edit-main-info",3,"formGroup","ngSubmit"],[1,"left-col"],["formControlName","image_small","diskPrefix","artist"],["type","submit","mat-raised-button","","color","accent","class","main-button","trans","",4,"ngIf"],[1,"right-col","many-inputs","admin-artist-edit-inputs"],["color","accent","animationDuration","0ms"],[3,"label"],[1,"many-inputs","tab"],[1,"input-container"],["for","artist-name","trans",""],["type","text","formControlName","name","id","artist-name","required","",3,"readOnly"],["class","error",4,"ngIf"],["for","artist-genres","trans",""],["placeholder","+Add genre","id","artist-genres","formControlName","genres",3,"suggestFn"],[4,"ngIf"],["formControlName","links"],["for","artist-country","trans",""],["formControlName","country","id","artist-country"],["for","artist-city","trans",""],["formControlName","city","id","artist-city"],["for","artist-bio","trans",""],["formControlName","description","id","artist-bio","rows","8"],[1,"profile-images"],["trans","",1,"profile-images-title"],["formArrayName","profile_images",1,"profile-images-wrapper"],[3,"formControlName","uploadConfig","buttonText","fileDeleted",4,"ngFor","ngForOf"],[3,"albums","artist"],["type","submit","mat-raised-button","","color","accent","trans","",1,"main-button"],[1,"error"],["class","input-container",4,"ngIf"],[1,"setting-toggle-container"],["formControlName","verified","trans",""],["for","artist-spotify-id","trans",""],["type","text","id","artist-spotify-id","formControlName","spotify_id","minlength","22","maxlength","22"],[3,"formControlName","uploadConfig","buttonText","fileDeleted"]],template:function(t,e){1&t&&(g.TgZ(0,"div",0),g.TgZ(1,"form",1),g.NdJ("ngSubmit",function(){return e.createOrUpdate()}),g.TgZ(2,"div",2),g._UZ(3,"upload-image-control",3),g.YNc(4,Et,2,0,"button",4),g.YNc(5,zt,2,0,"button",4),g.qZA(),g.TgZ(6,"div",5),g.TgZ(7,"mat-tab-group",6),g.TgZ(8,"mat-tab",7),g.ALo(9,"trans"),g.TgZ(10,"div",8),g.TgZ(11,"div",9),g.TgZ(12,"label",10),g._uU(13,"Name"),g.qZA(),g._UZ(14,"input",11),g.YNc(15,Bt,2,1,"div",12),g.qZA(),g.TgZ(16,"div",9),g.TgZ(17,"label",13),g._uU(18,"Genres"),g.qZA(),g._UZ(19,"chip-input",14),g.YNc(20,Gt,2,1,"div",12),g.qZA(),g.YNc(21,Ht,6,2,"ng-container",15),g.qZA(),g.qZA(),g.TgZ(22,"mat-tab",7),g.ALo(23,"trans"),g._UZ(24,"profile-links-form-control",16),g.qZA(),g.TgZ(25,"mat-tab",7),g.ALo(26,"trans"),g.TgZ(27,"div",8),g.TgZ(28,"div",9),g.TgZ(29,"label",17),g._uU(30,"Country"),g.qZA(),g._UZ(31,"input",18),g.qZA(),g.TgZ(32,"div",9),g.TgZ(33,"label",19),g._uU(34,"City"),g.qZA(),g._UZ(35,"input",20),g.qZA(),g.TgZ(36,"div",9),g.TgZ(37,"label",21),g._uU(38,"Biography"),g.qZA(),g._UZ(39,"textarea",22),g.qZA(),g.TgZ(40,"div",23),g.TgZ(41,"div",24),g._uU(42,"Biography Images"),g.qZA(),g.TgZ(43,"div",25),g.YNc(44,Wt,1,6,"upload-image-control",26),g.qZA(),g.qZA(),g.qZA(),g.qZA(),g.qZA(),g.qZA(),g.qZA(),g._UZ(45,"artist-albums-table",27),g.qZA()),2&t&&(g.xp6(1),g.Q6J("formGroup",e.form),g.xp6(3),g.Q6J("ngIf",e.artist),g.xp6(1),g.Q6J("ngIf",!e.artist),g.xp6(3),g.Q6J("label",g.lcZ(9,14,"Details")),g.xp6(6),g.Q6J("readOnly",!e.insideAdmin),g.xp6(1),g.Q6J("ngIf",e.errors.name),g.xp6(4),g.Q6J("suggestFn",e.suggestGenreFn),g.xp6(1),g.Q6J("ngIf",e.errors.genres),g.xp6(1),g.Q6J("ngIf",e.insideAdmin),g.xp6(1),g.Q6J("label",g.lcZ(23,16,"Links")),g.xp6(3),g.Q6J("label",g.lcZ(26,18,"Biography")),g.xp6(19),g.Q6J("ngForOf",e.profileImagesArray().controls),g.xp6(1),g.Q6J("albums",e.albums)("artist",e.artist))},directives:[h.JL,h.sg,_.V,h.JJ,h.u,u.O5,xt.SP,xt.uX,k.P,h.Fj,h.Q7,yt.S,kt.z,h.CE,u.sg,St,A.lW,Lt.Rr,h.wO,h.nD],pipes:[Jt.R],styles:[".edit-main-info[_ngcontent-%COMP%]{display:flex}.edit-main-info[_ngcontent-%COMP%]   .left-col[_ngcontent-%COMP%]{width:220px;flex-shrink:0;margin-right:25px}.edit-main-info[_ngcontent-%COMP%]   .left-col[_ngcontent-%COMP%]   .main-button[_ngcontent-%COMP%]{display:block;margin-top:8px;width:100%;line-height:42px}.edit-main-info[_ngcontent-%COMP%]   .left-col[_ngcontent-%COMP%]   .main-button[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{display:inline-block;vertical-align:middle}.edit-main-info[_ngcontent-%COMP%]   .right-col[_ngcontent-%COMP%]{flex:1 1 auto;min-width:0}@media only screen and (max-width: 768px){.edit-main-info[_ngcontent-%COMP%]{display:block}.edit-main-info[_ngcontent-%COMP%]   .left-col[_ngcontent-%COMP%]{max-width:220px;margin:auto auto 25px}}.tab[_ngcontent-%COMP%]{padding-top:20px}.profile-images[_ngcontent-%COMP%]{padding-top:20px;margin-top:30px;border-top:1px solid var(--be-divider-lighter)}.profile-images-title[_ngcontent-%COMP%]{font-size:1.5rem;margin-bottom:10px}.profile-images-wrapper[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.profile-images-wrapper[_ngcontent-%COMP%]   upload-image-control[_ngcontent-%COMP%]{margin:0 15px 15px 0}artist-albums-table[_ngcontent-%COMP%]{padding-top:35px;margin-top:35px;border-top:1px solid var(--be-divider-lighter)}"],changeDetection:0}),t}(),te=r(85816),ee=r(8117),ne=function(){var t=function(){function t(e,n){s(this,t),this.artists=e,this.router=n}return c(t,[{key:"resolve",value:function(t,e){var n=this,i=+t.paramMap.get("id");return this.artists.get(i,{with:["simplifiedAlbums","genres","profile"],albumsPerPage:50,forEditing:!0}).pipe((0,U.K)(function(){return n.router.navigate(["/"]),ee.E}),(0,te.zg)(function(t){return t.artist?(0,w.of)(t):(n.router.navigate(["/"]),ee.E)}))}}]),t}();return t.\u0275fac=function(e){return new(e||t)(g.LFG(vt.c),g.LFG(l.F0))},t.\u0275prov=g.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),ie=r(75766),ae=r(39698),re=r(1625),oe=r(41880),se=r(53534),ue=r(24890),ce=r(58480),le=r(47332),de=r(65718),pe=r(18715),me=r(68756),ge=r(16850),fe=r(82655),he=function(){var t,e=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&n(t,e)}(a,t);var e=i(a);function a(){var t;return s(this,a),(t=e.apply(this,arguments)).DEFAULT_MAX_SIZE_MB=50,t.showToast=!0,t}return c(a,[{key:"initValidations",value:function(){var t,e=[new me.p({maxSize:this.getMaxFileSize()},this.i18n),new fe.p({types:["audio","video"]},this.i18n)];(t=this.validations).push.apply(t,e)}},{key:"getMaxFileSize",value:function(){return this.settings.get("uploads.max_size",(0,ge.F)(this.DEFAULT_MAX_SIZE_MB,"MB"))}}]),a}(pe.c);return e.\u0275fac=function(n){return(t||(t=g.n5z(e)))(n||e)},e.\u0275prov=g.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),ve=r(38182),be=r(82516),Ze=r(53466),xe=r(65924),ye=r(79243),ke=r(24298),_e=["searchInput"];function Ae(t,e){if(1&t){var n=g.EpF();g.TgZ(0,"mat-chip",10),g.NdJ("removed",function(){var t=g.CHM(n).$implicit;return g.oxw().deselectArtist(t)}),g._UZ(1,"img",11),g._uU(2),g._UZ(3,"mat-icon",12),g.qZA()}if(2&t){var i=e.$implicit;g.Q6J("removable",!0),g.xp6(1),g.Q6J("src",i.image_small,g.LSH)("alt",i.name),g.xp6(1),g.hij(" ",i.name," ")}}function qe(t,e){if(1&t&&(g.TgZ(0,"mat-option",13),g._UZ(1,"img",11),g.TgZ(2,"span"),g._uU(3),g.qZA(),g.qZA()),2&t){var n=e.$implicit;g.Q6J("value",n),g.xp6(1),g.Q6J("src",n.image_small,g.LSH)("alt",n.name+" image"),g.xp6(2),g.Oqu(n.name)}}function Ce(t,e){if(1&t&&(g.TgZ(0,"div",14),g._uU(1),g.qZA()),2&t){var n=g.oxw();g.xp6(1),g.Oqu(n.error)}}var Te=function(){var e=function(){function e(t,n){s(this,e),this.search=t,this.currentUser=n,this.searchControl=new h.NI,this.value$=new d.X([]),this.searchResults$=new d.X([])}return c(e,[{key:"ngOnInit",value:function(){this.bindSearchControl()}},{key:"ngAfterViewInit",value:function(){var t=this;(0,be.R)(this.searchInput.nativeElement,"focus").pipe((0,Ze.q)(1)).subscribe(function(){t.findMatches()})}},{key:"writeValue",value:function(t){this.value$.next(t)}},{key:"registerOnChange",value:function(t){this.propagateChange=t}},{key:"registerOnTouched",value:function(){}},{key:"deselectArtist",value:function(t){var e=this.value$.value.filter(function(e){return e.id!==t.id});this.value$.next(e),this.propagateChange(this.value$.value)}},{key:"selectArtist",value:function(e){-1===this.value$.value.findIndex(function(t){return t.id===e.id})&&(this.value$.next([].concat(t(this.value$.value),[e])),this.propagateChange(this.value$.value)),this.searchInput.nativeElement.blur()}},{key:"bindSearchControl",value:function(){var t=this;this.searchControl.valueChanges.pipe((0,I.x)(),(0,O.b)(250)).subscribe(function(e){if("string"!=typeof e)return(0,w.of)([]);t.findMatches(e)})}},{key:"findMatches",value:function(t){var e=this;this.search.suggestArtists({query:t,limit:7}).subscribe(function(t){return e.searchResults$.next(t.artists)})}},{key:"displayFn",value:function(t){return null}}]),e}();return e.\u0275fac=function(t){return new(t||e)(g.Y36(J.o),g.Y36(wt.I))},e.\u0275cmp=g.Xpm({type:e,selectors:[["track-artist-control"]],viewQuery:function(t,e){var n;(1&t&&g.Gf(_e,5),2&t)&&(g.iGM(n=g.CRH())&&(e.searchInput=n.first))},hostAttrs:[1,"custom-control"],inputs:{error:"error",id:"id"},features:[g._Bn([x.A,{provide:h.JU,useExisting:e,multi:!0}])],decls:13,vars:13,consts:[[1,"input-container"],["trans","",3,"for"],["type","text","placeholder","Search artists...","trans-placeholder","",3,"id","formControl","matAutocomplete"],["searchInput",""],[3,"selectable"],["class","chip-with-image",3,"removable","removed",4,"ngFor","ngForOf"],[1,"media-autocomplete-panel",3,"displayWith","optionSelected"],["artistAuto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["class","error",4,"ngIf"],[1,"chip-with-image",3,"removable","removed"],[3,"src","alt"],["svgIcon","cancel","matChipRemove",""],[3,"value"],[1,"error"]],template:function(t,e){if(1&t&&(g.TgZ(0,"div",0),g.TgZ(1,"label",1),g._uU(2,"Artists"),g.qZA(),g._UZ(3,"input",2,3),g.TgZ(5,"mat-chip-list",4),g.YNc(6,Ae,4,4,"mat-chip",5),g.ALo(7,"async"),g.qZA(),g.TgZ(8,"mat-autocomplete",6,7),g.NdJ("optionSelected",function(t){return e.selectArtist(t.option.value)}),g.YNc(10,qe,4,4,"mat-option",8),g.ALo(11,"async"),g.qZA(),g.YNc(12,Ce,2,1,"div",9),g.qZA()),2&t){var n=g.MAs(9);g.xp6(1),g.Q6J("for",e.id),g.xp6(2),g.Q6J("id",e.id)("formControl",e.searchControl)("matAutocomplete",n),g.xp6(2),g.Q6J("selectable",!1),g.xp6(1),g.Q6J("ngForOf",g.lcZ(7,9,e.value$)),g.xp6(2),g.Q6J("displayWith",e.displayFn),g.xp6(2),g.Q6J("ngForOf",g.lcZ(11,11,e.searchResults$)),g.xp6(2),g.Q6J("ngIf",e.error)}},directives:[k.P,h.Fj,xe.ZL,h.JJ,h.oH,ye.qn,u.sg,xe.XC,u.O5,ye.HS,q.Hw,ye.qH,ke.ey],pipes:[u.Ov],styles:["[_nghost-%COMP%]{display:block}.mat-chip-list[_ngcontent-%COMP%]{display:block;margin-top:15px}.mat-standard-chip.chip-with-image[_ngcontent-%COMP%]{padding-left:0}.mat-standard-chip.chip-with-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:32px;height:32px;-o-object-fit:cover;object-fit:cover;border-radius:16px;margin-right:8px}"],changeDetection:0}),e}(),we=r(8095),Oe=r(15565),Ie=r(365);function Pe(t,e){if(1&t&&(g.TgZ(0,"div",7),g._uU(1),g.TgZ(2,"span",8),g._uU(3,"left"),g.qZA(),g.qZA()),2&t){var n=g.oxw();g.xp6(1),g.hij(" ",n.progress.eta," ")}}function Ue(t,e){1&t&&(g._UZ(0,"mat-icon",9),g.ALo(1,"trans")),2&t&&g.Q6J("matTooltip",g.lcZ(1,1,e.ngIf))}function Me(t,e){1&t&&(g.TgZ(0,"span",8),g._uU(1,"Upload complete."),g.qZA())}function Je(t,e){1&t&&(g.TgZ(0,"span",8),g._uU(1,"We are processing your track for playback\u2026"),g.qZA())}function Qe(t,e){if(1&t){var n=g.EpF();g.TgZ(0,"span",12),g.NdJ("click",function(){return g.CHM(n),g.oxw(2).upload.cancel()}),g._uU(1,"Cancel"),g.qZA()}}function Fe(t,e){if(1&t&&(g.YNc(0,Me,2,0,"span",10),g.YNc(1,Je,2,0,"span",10),g.ALo(2,"async"),g.YNc(3,Qe,2,0,"span",11),g.ALo(4,"async")),2&t){var n=g.oxw();g.Q6J("ngIf",n.upload.completed),g.xp6(1),g.Q6J("ngIf",g.lcZ(2,3,n.upload.processing$)),g.xp6(2),g.Q6J("ngIf",!g.lcZ(4,5,n.upload.processing$)&&!n.upload.completed)}}var Ne=function(){var t=function(){function t(e){s(this,t),this.cd=e}return c(t,[{key:"ngOnChanges",value:function(){var t=this;this.subscription&&this.subscription.unsubscribe(),this.subscription=this.upload.progress$.pipe((0,we.p)(260,Oe.Z,{leading:!0,trailing:!0})).subscribe(function(e){t.progress=e,t.cd.detectChanges()})}},{key:"ngOnDestroy",value:function(){this.subscription.unsubscribe()}}]),t}();return t.\u0275fac=function(e){return new(e||t)(g.Y36(g.sBO))},t.\u0275cmp=g.Xpm({type:t,selectors:[["track-upload-header"]],inputs:{upload:"upload"},features:[g.TTD],decls:11,vars:10,consts:[[1,"meta"],[1,"name"],["class","time-left",4,"ngIf"],[1,"actions"],["class","error-icon action-icon","svgIcon","error-outline","matTooltipPosition","left",3,"matTooltip",4,"ngIf","ngIfElse"],["noError",""],["color","accent",3,"mode","value"],[1,"time-left"],["trans",""],["svgIcon","error-outline","matTooltipPosition","left",1,"error-icon","action-icon",3,"matTooltip"],["trans","",4,"ngIf"],["class","cancel-button","trans","",3,"click",4,"ngIf"],["trans","",1,"cancel-button",3,"click"]],template:function(t,e){if(1&t&&(g.TgZ(0,"div",0),g.TgZ(1,"div",1),g._uU(2),g.qZA(),g.YNc(3,Pe,4,1,"div",2),g.TgZ(4,"div",3),g.YNc(5,Ue,2,3,"mat-icon",4),g.ALo(6,"async"),g.YNc(7,Fe,5,7,"ng-template",null,5,g.W1O),g.qZA(),g.qZA(),g._UZ(9,"mat-progress-bar",6),g.ALo(10,"async")),2&t){var n=g.MAs(8);g.xp6(2),g.Oqu(e.upload.uploadedFile.name),g.xp6(1),g.Q6J("ngIf",e.progress.percentage&&e.progress.percentage<100&&!e.upload.error$.value),g.xp6(2),g.Q6J("ngIf",g.lcZ(6,6,e.upload.error$))("ngIfElse",n),g.xp6(4),g.Q6J("mode",g.lcZ(10,8,e.upload.processing$)?"indeterminate":"determinate")("value",e.progress.percentage)}},directives:[u.O5,Ie.pW,k.P,q.Hw,Ut.gM],pipes:[u.Ov,Jt.R],styles:["[_nghost-%COMP%]{display:block;color:var(--be-secondary-text);font-size:1.3rem}.meta[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:5px}.name[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.time-left[_ngcontent-%COMP%]{padding-left:20px;white-space:nowrap}.actions[_ngcontent-%COMP%]{margin-left:auto;padding-left:20px}.action-icon[_ngcontent-%COMP%]{vertical-align:middle;width:22px;height:22px;margin-bottom:4px}.completed-icon[_ngcontent-%COMP%]{color:#43a047}.error-icon[_ngcontent-%COMP%]{color:#f44336}.cancel-button[_ngcontent-%COMP%]{color:var(--be-link);cursor:pointer;font-size:1.2rem;text-transform:uppercase;line-height:22px}.cancel-button[_ngcontent-%COMP%]:hover{text-decoration:underline}"],changeDetection:0}),t}(),Ye=r(38172),$e=["searchInput"],De=["fakeInput"];function Se(t,e){if(1&t&&(g.ynx(0),g._UZ(1,"media-image",23),g.TgZ(2,"div",24),g._uU(3),g.qZA(),g.BQk()),2&t){var n=e.ngIf;g.xp6(1),g.Q6J("media",n),g.xp6(2),g.Oqu(n.name)}}function Le(t,e){1&t&&(g.TgZ(0,"div",25),g._uU(1,"None"),g.qZA())}function Ee(t,e){if(1&t){var n=g.EpF();g.TgZ(0,"button",26),g.NdJ("click",function(){return g.CHM(n),g.oxw().clearSearchInput()}),g._UZ(1,"mat-icon",27),g.qZA()}}function ze(t,e){if(1&t){var n=g.EpF();g.TgZ(0,"button",17),g.NdJ("click",function(){var t=g.CHM(n).$implicit;return g.oxw().selectAlbum(t)}),g._UZ(1,"media-image",23),g.TgZ(2,"div",28),g.TgZ(3,"div",29),g._uU(4),g.qZA(),g._UZ(5,"artists-links-list",30),g.qZA(),g.qZA()}if(2&t){var i=e.$implicit;g.xp6(1),g.Q6J("media",i),g.xp6(3),g.Oqu(i.name),g.xp6(1),g.Q6J("artists",i.artists)}}function Be(t,e){1&t&&(g.TgZ(0,"button",31),g._uU(1,"No albums found."),g.qZA())}var Ge=function(){var t=function(){function t(e,n){s(this,t),this.search=e,this.currentUser=n,this.searchFormControl=new h.NI,this.loading$=new d.X(!1),this.results$=new d.X([]),this.selectedAlbum$=new d.X(null),this.searchedOnce=!1}return c(t,[{key:"ngOnInit",value:function(){this.bindToSearchControl()}},{key:"writeValue",value:function(t){this.selectedAlbum$.next(t)}},{key:"registerOnChange",value:function(t){this.propagateChange=t}},{key:"registerOnTouched",value:function(){}},{key:"bindToSearchControl",value:function(){var t=this;this.searchFormControl.valueChanges.pipe((0,O.b)(150),(0,I.x)(),(0,P.w)(function(e){return t.searchAlbums(e)}),(0,U.K)(function(){return(0,w.of)([])})).subscribe(function(e){t.searchedOnce=!0,t.results$.next(e)})}},{key:"searchAlbums",value:function(t){var e=this;return this.loading$.next(!0),this.search.suggestAlbums({query:t,limit:7}).pipe((0,p.x)(function(){return e.loading$.next(!1)}),(0,M.U)(function(t){return t.albums}))}},{key:"onMenuOpened",value:function(){document.querySelector(".add-album-control-menu").style.width=this.fakeInput.nativeElement.getBoundingClientRect().width+"px",this.searchedOnce||this.clearSearchInput()}},{key:"selectAlbum",value:function(t){this.selectedAlbum$.next(t),this.propagateChange(t)}},{key:"clearSearchInput",value:function(){this.searchFormControl.setValue("")}},{key:"onMenuClosed",value:function(){this.loading$.next(!1),this.clearSearchInput()}}]),t}();return t.\u0275fac=function(e){return new(e||t)(g.Y36(J.o),g.Y36(wt.I))},t.\u0275cmp=g.Xpm({type:t,selectors:[["album-control"]],viewQuery:function(t,e){var n;(1&t&&(g.Gf($e,7),g.Gf(De,5)),2&t)&&(g.iGM(n=g.CRH())&&(e.searchInput=n.first),g.iGM(n=g.CRH())&&(e.fakeInput=n.first))},features:[g._Bn([{provide:h.JU,useExisting:t,multi:!0}])],decls:30,vars:16,consts:[[1,"many-inputs"],[1,"input-container"],["trans","",1,"fake-label"],["tabindex","0",1,"fake-input",3,"matMenuTriggerFor","menuOpened","menuClosed"],["fakeInput",""],[4,"ngIf","ngIfElse"],["anyAlbum",""],[1,"arrow-container"],[1,"arrow"],[1,"add-album-control-menu"],["menu","matMenu"],[1,"input-container","search-input-container",3,"click"],[1,"search-input-wrapper"],["type","text","placeholder","Search...","mat-menu-item","","trans-placeholder","",3,"formControl","blur"],["searchInput",""],["class","clear-search-input-button","mat-icon-button","",3,"click",4,"ngIf"],[1,"small",3,"isVisible"],["mat-menu-item","",3,"click"],["default","album"],[1,"info","any-user-info"],["trans","",1,"name"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["mat-menu-item","","disabled","","trans","",4,"ngIf"],[3,"media"],[1,"title-name"],["trans","",1,"title-name"],["mat-icon-button","",1,"clear-search-input-button",3,"click"],["svgIcon","close"],[1,"user-info"],[1,"name"],[1,"email",3,"artists"],["mat-menu-item","","disabled","","trans",""]],template:function(t,e){if(1&t){var n=g.EpF();g.TgZ(0,"div",0),g.TgZ(1,"div",1),g.TgZ(2,"div",2),g._uU(3,"Album"),g.qZA(),g.TgZ(4,"div",3,4),g.NdJ("menuOpened",function(){return e.onMenuOpened()})("menuClosed",function(){return e.onMenuClosed()}),g.YNc(6,Se,4,2,"ng-container",5),g.ALo(7,"async"),g.YNc(8,Le,2,0,"ng-template",null,6,g.W1O),g.TgZ(10,"div",7),g._UZ(11,"div",8),g.qZA(),g.qZA(),g.qZA(),g.qZA(),g.TgZ(12,"mat-menu",9,10),g.TgZ(14,"div",11),g.NdJ("click",function(t){return t.stopPropagation()}),g.TgZ(15,"div",12),g.TgZ(16,"input",13,14),g.NdJ("blur",function(){return g.CHM(n),g.MAs(17).focus()}),g.qZA(),g.YNc(18,Ee,2,0,"button",15),g._UZ(19,"loading-indicator",16),g.ALo(20,"async"),g.qZA(),g.qZA(),g.TgZ(21,"button",17),g.NdJ("click",function(){return e.selectAlbum(null)}),g._UZ(22,"media-image",18),g.TgZ(23,"div",19),g.TgZ(24,"div",20),g._uU(25,"No Album"),g.qZA(),g.qZA(),g.qZA(),g.YNc(26,ze,6,3,"button",21),g.ALo(27,"async"),g.YNc(28,Be,2,0,"button",22),g.ALo(29,"async"),g.qZA()}if(2&t){var i=g.MAs(9),a=g.MAs(13);g.xp6(4),g.Q6J("matMenuTriggerFor",a),g.xp6(2),g.Q6J("ngIf",g.lcZ(7,8,e.selectedAlbum$))("ngIfElse",i),g.xp6(10),g.Q6J("formControl",e.searchFormControl),g.xp6(2),g.Q6J("ngIf",e.searchFormControl.value),g.xp6(1),g.Q6J("isVisible",g.lcZ(20,10,e.loading$)),g.xp6(7),g.Q6J("ngForOf",g.lcZ(27,12,e.results$)),g.xp6(2),g.Q6J("ngIf",e.searchedOnce&&!g.lcZ(29,14,e.results$).length)}},directives:[k.P,Q.p6,u.O5,Q.yF,h.Fj,Q.OP,h.JJ,h.oH,F.Q,N.P,u.sg,A.lW,q.Hw,Ye.t],pipes:[u.Ov],styles:["[_nghost-%COMP%]{display:block;min-width:280px;max-width:100%}.fake-input[_ngcontent-%COMP%]{display:flex;align-items:center}.fake-label[_ngcontent-%COMP%]{text-transform:capitalize}.title-name[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}media-image[_ngcontent-%COMP%]{display:inline-block;margin-right:8px;width:35px;height:35px;flex-shrink:0;border-radius:4px;vertical-align:middle}.arrow-container[_ngcontent-%COMP%]{flex-shrink:0;padding-left:8px;margin-left:auto}.arrow[_ngcontent-%COMP%]{border-color:#000 transparent transparent transparent;border-style:solid;border-width:5px 4px 0 4px;height:0;width:0}  .mat-menu-panel.add-album-control-menu{max-width:none}.mat-menu-item[_ngcontent-%COMP%]:first-of-type{border-top:1px solid var(--be-divider-default)}.search-input-container[_ngcontent-%COMP%]{padding:2px 10px 10px}.search-input-wrapper[_ngcontent-%COMP%]{position:relative}.clear-search-input-button[_ngcontent-%COMP%]{position:absolute;top:4px;right:0;color:var(--be-secondary-text)}.mat-menu-item[_ngcontent-%COMP%]:not(input){display:flex;vertical-align:middle;height:65px;line-height:65px;align-items:center}.mat-menu-item[_ngcontent-%COMP%]:not(input).selected{background-color:var(--be-accent-emphasis)}.mat-menu-item[_ngcontent-%COMP%]:not(input)   media-image[_ngcontent-%COMP%]{width:45px;height:45px;margin-right:15px;border-radius:50%}.mat-menu-item[_ngcontent-%COMP%]:not(input)   .name[_ngcontent-%COMP%]{text-transform:capitalize;overflow:hidden;text-overflow:ellipsis}.mat-menu-item[_ngcontent-%COMP%]:not(input)   .email[_ngcontent-%COMP%]{color:var(--be-secondary-text);font-size:1.3rem;overflow:hidden;text-overflow:ellipsis}.user-info[_ngcontent-%COMP%]{line-height:normal;line-height:initial}.any-user-info[_ngcontent-%COMP%]{line-height:35px}loading-indicator[_ngcontent-%COMP%]{position:absolute;top:12px;right:40px}.disabled[_ngcontent-%COMP%]{pointer-events:none;opacity:.7}"],changeDetection:0}),t}();function Ve(t,e){if(1&t&&g._UZ(0,"track-upload-header",23),2&t){var n=g.oxw(2);g.Q6J("upload",n.uploadQueueItem)}}function je(t,e){if(1&t){var n=g.EpF();g.TgZ(0,"div",24),g.Hsn(1),g.TgZ(2,"div",14),g.TgZ(3,"label",25),g._uU(4,"Title"),g.qZA(),g._UZ(5,"input",26),g.qZA(),g.TgZ(6,"div",27),g.TgZ(7,"button",28),g.NdJ("click",function(){return g.CHM(n),g.oxw(2).toggleExpandedState()}),g._UZ(8,"mat-icon",29),g.qZA(),g.TgZ(9,"button",28),g.NdJ("click",function(){return g.CHM(n),g.oxw(2).maybeCancel()}),g._UZ(10,"mat-icon",30),g.qZA(),g.qZA(),g.qZA()}if(2&t){var i=g.oxw(2);g.Q6J("formGroup",i.form),g.xp6(3),g.Q6J("for","track-form-"+i.uniqueId+"-name"),g.xp6(2),g.Q6J("id","track-form-"+i.uniqueId+"-name"),g.xp6(2),g.ekj("active",i.expanded)}}function He(t,e){1&t&&(g.TgZ(0,"span",31),g._uU(1,"Replace File"),g.qZA())}function Re(t,e){1&t&&(g.TgZ(0,"span",31),g._uU(1,"Upload Track"),g.qZA())}function Xe(t,e){if(1&t&&(g.TgZ(0,"div",32),g._uU(1),g.qZA()),2&t){var n=g.oxw(2).ngIf;g.xp6(1),g.Oqu(n.name)}}function We(t,e){if(1&t&&(g.TgZ(0,"div",14),g.TgZ(1,"label",15),g._uU(2,"Title"),g.qZA(),g._UZ(3,"input",26),g.YNc(4,Xe,2,1,"div",17),g.qZA()),2&t){var n=g.oxw().ngIf,i=g.oxw();g.xp6(1),g.Q6J("for","track-form-"+i.uniqueId+"-name"),g.xp6(2),g.Q6J("id","track-form-"+i.uniqueId+"-name"),g.xp6(1),g.Q6J("ngIf",n.name)}}function Ke(t,e){if(1&t&&g._UZ(0,"album-control",33),2&t){var n=g.oxw(2);g.Q6J("id","track-form-"+n.uniqueId+"-album_id")}}function tn(t,e){if(1&t&&(g.TgZ(0,"div",32),g._uU(1),g.qZA()),2&t){var n=g.oxw().ngIf;g.xp6(1),g.Oqu(n.duration)}}function en(t,e){if(1&t&&(g.TgZ(0,"div",32),g._uU(1),g.qZA()),2&t){var n=g.oxw(2).ngIf;g.xp6(1),g.Oqu(n.youtube_id)}}function nn(t,e){if(1&t&&(g.TgZ(0,"div",14),g.TgZ(1,"label",15),g._uU(2,"Youtube Video ID"),g.qZA(),g._UZ(3,"input",34),g.YNc(4,en,2,1,"div",17),g.TgZ(5,"p"),g._uU(6,"ID only. https://www.youtube.com/embed?v="),g.TgZ(7,"strong"),g._uU(8,"EPyh41zPg4Z"),g.qZA(),g.qZA(),g.qZA()),2&t){var n=g.oxw().ngIf,i=g.oxw();g.xp6(1),g.Q6J("for","track-form-"+i.uniqueId+"-track-youtube-id"),g.xp6(2),g.Q6J("id","track-form-"+i.uniqueId+"-track-youtube-id"),g.xp6(1),g.Q6J("ngIf",n.youtube_id)}}function an(t,e){if(1&t&&(g.TgZ(0,"div",32),g._uU(1),g.qZA()),2&t){var n=g.oxw(2).ngIf;g.xp6(1),g.Oqu(n.url)}}function rn(t,e){if(1&t&&(g.TgZ(0,"div",14),g.TgZ(1,"label",15),g._uU(2,"Track Url"),g.qZA(),g._UZ(3,"input",35),g.YNc(4,an,2,1,"div",17),g.TgZ(5,"p"),g._uU(6,"Remote or local url to music or video file for this track. If available, this will always play instead of youtube video."),g.qZA(),g.qZA()),2&t){var n=g.oxw().ngIf,i=g.oxw();g.xp6(1),g.Q6J("for","track-form-"+i.uniqueId+"-track-url"),g.xp6(2),g.Q6J("id","track-form-"+i.uniqueId+"-track-url"),g.xp6(1),g.Q6J("ngIf",n.url)}}function on(t,e){1&t&&(g.TgZ(0,"div",14),g.TgZ(1,"label",36),g._uU(2,"Spotify ID"),g.qZA(),g._UZ(3,"input",37),g.qZA())}function sn(t,e){if(1&t&&(g.TgZ(0,"div",32),g._uU(1),g.qZA()),2&t){var n=g.oxw().ngIf;g.xp6(1),g.Oqu(n.genres)}}function un(t,e){if(1&t&&(g.TgZ(0,"div",32),g._uU(1),g.qZA()),2&t){var n=g.oxw().ngIf;g.xp6(1),g.Oqu(n.tags)}}function cn(t,e){if(1&t&&(g.TgZ(0,"button",38),g.ALo(1,"async"),g._uU(2,"Save"),g.qZA()),2&t){var n=g.oxw(2);g.Q6J("disabled",g.lcZ(1,1,n.loading$)||n.uploadQueueItem&&!n.uploadQueueItem.completed)}}function ln(t,e){if(1&t){var n=g.EpF();g.TgZ(0,"button",39),g.NdJ("click",function(){return g.CHM(n),g.oxw(2).maybeCancel()}),g._uU(1,"Cancel"),g.qZA()}}function dn(t,e){if(1&t){var n=g.EpF();g.TgZ(0,"form",1),g.NdJ("ngSubmit",function(){return g.CHM(n),g.oxw().submit()}),g.YNc(1,Ve,1,1,"track-upload-header",2),g.YNc(2,je,11,5,"div",3),g.TgZ(3,"div",4),g.TgZ(4,"div",5),g.TgZ(5,"div",6),g._UZ(6,"upload-image-control",7),g.ALo(7,"async"),g.TgZ(8,"button",8),g.NdJ("click",function(){return g.CHM(n),g.oxw().openUploadMusicModal()}),g.YNc(9,He,2,0,"span",9),g.YNc(10,Re,2,0,"span",9),g.qZA(),g.qZA(),g.TgZ(11,"div",10),g.YNc(12,We,5,3,"div",11),g.YNc(13,Ke,1,1,"album-control",12),g._UZ(14,"track-artist-control",13),g.TgZ(15,"div",14),g.TgZ(16,"label",15),g._uU(17,"Duration (ms)"),g.qZA(),g._UZ(18,"input",16),g.YNc(19,tn,2,1,"div",17),g.qZA(),g.YNc(20,nn,9,3,"div",11),g.YNc(21,rn,7,3,"div",11),g.YNc(22,on,4,0,"div",11),g.TgZ(23,"div",14),g.TgZ(24,"label",15),g._uU(25,"Genres"),g.qZA(),g._UZ(26,"chip-input",18),g.YNc(27,sn,2,1,"div",17),g.qZA(),g.TgZ(28,"div",14),g.TgZ(29,"label",15),g._uU(30,"Tags"),g.qZA(),g._UZ(31,"chip-input",19),g.YNc(32,un,2,1,"div",17),g.qZA(),g.TgZ(33,"div",14),g.TgZ(34,"label",15),g._uU(35,"Description"),g.qZA(),g._UZ(36,"textarea",20),g.qZA(),g.YNc(37,cn,3,3,"button",21),g.YNc(38,ln,2,0,"button",22),g.qZA(),g.qZA(),g.qZA(),g.qZA()}if(2&t){var i=e.ngIf,a=g.oxw();g.Q6J("formGroup",a.form),g.xp6(1),g.Q6J("ngIf",a.uploadQueueItem),g.xp6(1),g.Q6J("ngIf",a.albumForm),g.xp6(1),g.Q6J("@bodyExpansion",a.getExpandedState()),g.xp6(1),g.ekj("inside-album",a.albumForm),g.xp6(2),g.Q6J("defaultBackground",g.lcZ(7,31,a.defaultImage$)),g.xp6(3),g.Q6J("ngIf",a.track),g.xp6(1),g.Q6J("ngIf",!a.track),g.xp6(2),g.Q6J("ngIf",!a.albumForm),g.xp6(1),g.Q6J("ngIf",!a.albumForm),g.xp6(1),g.Q6J("error",i.artists)("id","track-form-"+a.uniqueId+"-artists"),g.xp6(2),g.Q6J("for","track-form-"+a.uniqueId+"-duration"),g.xp6(2),g.Q6J("id","track-form-"+a.uniqueId+"-duration"),g.xp6(1),g.Q6J("ngIf",i.duration),g.xp6(1),g.Q6J("ngIf",a.insideAdmin()),g.xp6(1),g.Q6J("ngIf",a.insideAdmin()),g.xp6(1),g.Q6J("ngIf",a.insideAdmin&&a.settings.get("spotify_is_setup")),g.xp6(2),g.Q6J("for","track-form-"+a.uniqueId+"-track-genres"),g.xp6(2),g.Q6J("id","track-form-"+a.uniqueId+"-track-genres")("suggestFn",a.suggestGenreFn),g.xp6(1),g.Q6J("ngIf",i.genres),g.xp6(2),g.Q6J("for","track-form-"+a.uniqueId+"-track-tags"),g.xp6(2),g.Q6J("id","track-form-"+a.uniqueId+"-track-tags")("suggestFn",a.suggestTagFn),g.xp6(1),g.Q6J("ngIf",i.tags),g.xp6(2),g.Q6J("for","track-form-"+a.uniqueId+"-track-description"),g.xp6(2),g.Q6J("id","track-form-"+a.uniqueId+"-track-description"),g.xp6(1),g.Q6J("ngIf",!a.albumForm),g.xp6(1),g.Q6J("ngIf",!a.albumForm&&!a.track)}}var pn=["*"],mn=function(){var t=function(){function t(e,n,i,a,r,o,u,c,l,p,m,f){var h=this;s(this,t),this.fb=e,this.currentUser=n,this.tracks=i,this.toast=a,this.modal=r,this.audioValidator=o,this.uploadQueue=u,this.waveGenerator=c,this.router=l,this.settings=p,this.cd=m,this.search=f,this.canceled=new g.vpe,this.saved=new g.vpe,this.errors$=new d.X({}),this.defaultImage$=new d.X(ae.e.album),this.loading$=new d.X(!1),this.uniqueId=(0,ce.O)(5),this.form=this.fb.group({id:[null],name:[""],image:[""],description:[""],number:[1],tags:[[]],genres:[[]],duration:[null],url:[""],youtube_id:[""],spotify_id:[""],spotify_popularity:[""],album:[null],artists:[[]],waveData:[null],lyrics:[""]}),this.expanded=!1,this.suggestTagFn=function(t){return h.search.media(t,{types:["tag"],limit:5}).pipe((0,M.U)(function(t){return t.results.tags.map(function(t){return t.name})}))},this.suggestGenreFn=function(t){return h.search.media(t,{types:[ht.J],limit:5}).pipe((0,M.U)(function(t){return t.results.genres.map(function(t){return t.name})}))}}return c(t,[{key:"ngOnChanges",value:function(t){t.number&&null!=t.number.currentValue&&this.form.patchValue({number:t.number.currentValue})}},{key:"ngOnInit",value:function(){var t=this;if(this.expanded=!this.albumForm,this.track){var e=Object.assign({},this.track);e.tags=(this.track.tags||[]).map(function(t){return t.name}),e.genres=(this.track.genres||[]).map(function(t){return t.display_name||t.name}),this.form.patchValue(e),this.track.album&&this.defaultImage$.next(this.track.album.image||ae.e.album)}else this.currentUser.canAttachMusicToAnyArtist()||this.form.get("artists").setValue([this.currentUser.get("artists")[0]||this.currentUser.artistPlaceholder()]);this.uploadQueueItem&&this.uploadQueueItem.uploadedResponse$.subscribe(function(e){t.patchFormUsingFileUpload(e)}),this.albumForm&&this.albumForm.get("image").valueChanges.subscribe(function(e){t.defaultImage$.next(e||ae.e.album)})}},{key:"getPayload",value:function(){var t=this.uploadQueueItem?this.uploadQueueItem.customData:{},e=Object.assign(Object.assign({},this.form.value),t);return e.artists=e.artists.map(function(t){return"number"!=typeof t?t.id:t}),e}},{key:"isUploading",value:function(){return this.uploadQueueItem&&!this.uploadQueueItem.completed}},{key:"submit",value:function(){var t=this;if(!this.albumForm){this.loading$.next(!0);var e=this.getPayload();(this.track?this.tracks.update(this.track.id,e):this.tracks.create(e)).pipe((0,p.x)(function(){return t.loading$.next(!1)})).subscribe(function(e){t.uploadQueueItem&&t.uploadQueue.remove(t.uploadQueueItem.id),t.toast.open("Track saved."),t.form.markAsPristine(),t.saved.emit(e.track)},function(e){t.errors$.next(e.errors),(0,le.f)(t.errors$.value,"track-form-".concat(t.uniqueId))})}}},{key:"toggleExpandedState",value:function(){this.expanded=!this.expanded}},{key:"getExpandedState",value:function(){return this.expanded?"expanded":"collapsed"}},{key:"maybeCancel",value:function(){var t=this;this.modal.show(At.z,{title:"Remove Track",body:"Are you sure you want to cancel the upload and remove this track?",ok:"Remove"}).beforeClosed().subscribe(function(e){!e||(t.uploadQueueItem?(t.uploadQueue.remove(t.uploadQueueItem.id),t.canceled.emit(t.uploadQueueItem),t.toast.open("Upload canceled.")):t.track&&t.tracks.delete([t.track.id]).subscribe(function(){t.canceled.emit(t.track),t.toast.open("Track deleted.")}))})}},{key:"openUploadMusicModal",value:function(){var t=this,e={uri:"uploads",validator:this.audioValidator,httpParams:{diskPrefix:"track_media",disk:"public"},willProcessFiles:!0};(0,oe.r)({types:[se.j.audio,se.j.video]}).then(function(n){n&&(t.uploadQueue.start(t.uploadQueueItem?o({},t.uploadQueueItem.id,n[0]):n,e).subscribe(function(e){var n=t.uploadQueue.find(e.queueItemId);t.waveGenerator.generate(n.uploadedFile.native).then(function(e){t.form.patchValue({waveData:e}),n.finishProcessing()}),t.patchFormUsingFileUpload(e),t.toast.open("Track uploaded.")},function(){return t.toast.open("Could not upload track")}),t.uploadQueueItem||(t.uploadQueueItem=t.uploadQueue.uploads$.value[0],t.cd.markForCheck()))})}},{key:"patchFormUsingFileUpload",value:function(t){var e={name:t.metadata.title,duration:t.metadata.duration,url:t.fileEntry.url,genres:t.metadata.genres||[],description:t.metadata.comment,lyrics:t.metadata.lyrics};t.metadata.album&&(e.album=t.metadata.album),t.metadata.artist&&(e.artists=[t.metadata.artist],this.albumForm&&!this.albumForm.value.artist&&this.albumForm.patchValue({artist:t.metadata.artist})),t.metadata.image&&(e.image=t.metadata.image.url,this.albumForm&&!this.albumForm.value.image&&this.albumForm.patchValue({image:t.metadata.image.url})),t.metadata.release_date&&this.albumForm&&!this.albumForm.value.release_date&&this.albumForm.patchValue({release_date:t.metadata.release_date}),this.form.patchValue(e)}},{key:"insideAdmin",value:function(){return this.router.url.indexOf("admin")>-1}},{key:"shouldShowDurationField",value:function(){var t=this.form.get("url").value;return!t||(0,ue.s)(t)}}]),t}();return t.\u0275fac=function(e){return new(e||t)(g.Y36(h.qu),g.Y36(b.z),g.Y36(de.O),g.Y36(bt.F),g.Y36(Ct.u),g.Y36(he),g.Y36(x.A),g.Y36(ve.qQ),g.Y36(l.F0),g.Y36(v.Z),g.Y36(g.sBO),g.Y36(J.o))},t.\u0275cmp=g.Xpm({type:t,selectors:[["track-form"]],inputs:{track:"track",uploadQueueItem:"uploadQueueItem",albumForm:"albumForm",number:"number"},outputs:{canceled:"canceled",saved:"saved"},features:[g.TTD],ngContentSelectors:pn,decls:2,vars:3,consts:[["class","many-inputs",3,"formGroup","ngSubmit",4,"ngIf"],[1,"many-inputs",3,"formGroup","ngSubmit"],[3,"upload",4,"ngIf"],["class","inline-form",3,"formGroup",4,"ngIf"],[1,"full-form"],[1,"full-form-container"],[1,"left-column"],["formControlName","image","diskPrefix","track_image",3,"defaultBackground"],["mat-flat-button","","color","accent","type","button",1,"left-column-action-button",3,"click"],["trans","",4,"ngIf"],[1,"many-inputs","fields-container"],["class","input-container",4,"ngIf"],["formControlName","album",3,"id",4,"ngIf"],["formControlName","artists",3,"error","id"],[1,"input-container"],["trans","",3,"for"],["type","number","formControlName","duration","min","1","required","",3,"id"],["class","error",4,"ngIf"],["placeholder","+Add genre","formControlName","genres",3,"id","suggestFn"],["placeholder","+Add tag","formControlName","tags",3,"id","suggestFn"],["type","text","formControlName","description","minlength","10","maxlength","999","rows","5",3,"id"],["type","submit","mat-raised-button","","color","accent","trans","",3,"disabled",4,"ngIf"],["type","button","mat-button","","trans","",3,"click",4,"ngIf"],[3,"upload"],[1,"inline-form",3,"formGroup"],["trans","",1,"hidden",3,"for"],["type","text","formControlName","name","required","",3,"id"],[1,"actions"],["type","button","mat-icon-button","",3,"click"],["svgIcon","edit"],["svgIcon","delete"],["trans",""],[1,"error"],["formControlName","album",3,"id"],["type","text","formControlName","youtube_id","minlength","1","maxlength","30",3,"id"],["type","url","formControlName","url","minlength","1","maxlength","191",3,"id"],["for","track-spotify-id","trans",""],["type","text","id","track-spotify-id","formControlName","spotify_id","minlength","22","maxlength","22"],["type","submit","mat-raised-button","","color","accent","trans","",3,"disabled"],["type","button","mat-button","","trans","",3,"click"]],template:function(t,e){1&t&&(g.F$t(),g.YNc(0,dn,39,33,"form",0),g.ALo(1,"async")),2&t&&g.Q6J("ngIf",g.lcZ(1,1,e.errors$))},directives:[u.O5,h._Y,h.JL,h.sg,_.V,h.JJ,h.u,A.lW,Te,k.P,h.wV,h.qQ,h.Fj,h.Q7,yt.S,h.wO,h.nD,Ne,q.Hw,Ge],pipes:[u.Ov],styles:["[_nghost-%COMP%]{display:block}.inline-form[_ngcontent-%COMP%]{display:flex}.inline-form[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{flex-shrink:0;color:var(--be-secondary-text);margin-left:20px}.full-form[_ngcontent-%COMP%]{overflow:hidden}.full-form-container[_ngcontent-%COMP%]{display:flex}.full-form-container.inside-album[_ngcontent-%COMP%]{margin:25px 100px 0 60px}.fields-container[_ngcontent-%COMP%]{flex:1 1 auto;margin-left:20px;min-width:0}.cdk-drag-handle[_ngcontent-%COMP%]{flex-shrink:0;color:var(--be-secondary-text);margin-right:20px}.active[_ngcontent-%COMP%]{color:var(--be-accent-default)}track-upload-header[_ngcontent-%COMP%]{margin-bottom:15px}.drag-handle[_ngcontent-%COMP%]{cursor:move}.left-column-action-button[_ngcontent-%COMP%]{margin-top:15px;width:100%;line-height:40px}@media only screen and (max-width: 768px){.full-form-container[_ngcontent-%COMP%]{display:block}.left-column[_ngcontent-%COMP%]{max-width:220px;margin:auto auto 25px}.fields-container[_ngcontent-%COMP%]{margin-left:0}}"],data:{animation:[re.FX.bodyExpansion]},changeDetection:0}),t}();function gn(t,e){if(1&t&&(g.TgZ(0,"div",24),g._uU(1),g.qZA()),2&t){var n=g.oxw();g.xp6(1),g.Oqu(n.errors.name)}}function fn(t,e){if(1&t&&(g.TgZ(0,"div",24),g._uU(1),g.qZA()),2&t){var n=g.oxw();g.xp6(1),g.Oqu(n.errors.release_date)}}function hn(t,e){if(1&t&&(g.TgZ(0,"div",24),g._uU(1),g.qZA()),2&t){var n=g.oxw();g.xp6(1),g.Oqu(n.errors.description)}}function vn(t,e){if(1&t&&(g.TgZ(0,"div",24),g._uU(1),g.qZA()),2&t){var n=g.oxw();g.xp6(1),g.Oqu(n.errors.genres)}}function bn(t,e){if(1&t&&(g.TgZ(0,"div",24),g._uU(1),g.qZA()),2&t){var n=g.oxw();g.xp6(1),g.Oqu(n.errors.tags)}}function Zn(t,e){1&t&&(g.TgZ(0,"div",6),g.TgZ(1,"label",25),g._uU(2,"Spotify ID"),g.qZA(),g._UZ(3,"input",26),g.qZA())}function xn(t,e){if(1&t){var n=g.EpF();g.TgZ(0,"track-form",30),g.NdJ("canceled",function(){g.CHM(n);var t=g.oxw().$implicit;return g.oxw().trackRemoved(t)}),g.TgZ(1,"button",31),g._UZ(2,"mat-icon",32),g.qZA(),g.qZA()}if(2&t){var i=g.oxw(),a=i.$implicit,r=i.index,o=g.oxw();g.Q6J("albumForm",o.form)("track",a)("number",r+1)}}function yn(t,e){if(1&t){var n=g.EpF();g.TgZ(0,"track-form",33),g.NdJ("canceled",function(){g.CHM(n);var t=g.oxw().$implicit;return g.oxw().trackRemoved(t)}),g.TgZ(1,"button",31),g._UZ(2,"mat-icon",32),g.qZA(),g.qZA()}if(2&t){var i=g.oxw(),a=i.$implicit,r=i.index,o=g.oxw();g.Q6J("albumForm",o.form)("uploadQueueItem",a)("number",r+1)}}function kn(t,e){if(1&t&&(g.TgZ(0,"li",27),g.YNc(1,xn,3,3,"track-form",28),g.YNc(2,yn,3,3,"track-form",29),g.qZA()),2&t){var n=e.$implicit;g.xp6(1),g.Q6J("ngIf",n.model_type),g.xp6(1),g.Q6J("ngIf",!n.model_type)}}var _n=function(){return["music.update"]},An=function(){var e=function(){function e(t,n,i,a,r,o,u,c,l,p,m,f){var h=this;s(this,e),this.fb=t,this.uploadQueue=n,this.albums=i,this.cd=a,this.currentUser=r,this.modal=o,this.toast=u,this.audioValidator=c,this.settings=l,this.search=p,this.router=m,this.waveform=f,this.uploadButtonConfig={multiple:!0,types:[se.j.audio,se.j.video]},this.confirmCancel=!0,this.canceled=new g.vpe,this.saved=new g.vpe,this.errors={},this.loading$=new d.X(!1),this.allTracks$=new d.X([]),this.form=this.fb.group({name:[""],image:[""],artists:[[]],release_date:[(new Date).toISOString().slice(0,10)],description:[""],spotify_id:[""],tags:[[]],genres:[[]]}),this.trackByFn=function(t,e){return e.id},this.suggestTagFn=function(t){return h.search.media(t,{types:["tag"],limit:5}).pipe((0,M.U)(function(t){return t.results.tags.map(function(t){return t.name})}))},this.suggestGenreFn=function(t){return h.search.media(t,{types:[ht.J],limit:5}).pipe((0,M.U)(function(t){return t.results.genres.map(function(t){return t.name})}))}}return c(e,[{key:"ngOnInit",value:function(){var e=this;if(this.insideAdmin=this.router.url.includes("admin"),this.allTracks$=new d.X([].concat(t(this.album?this.album.tracks:[]),t(this.onlyValidUploads(this.uploadQueue.uploads$.value)))),this.uploadQueue.uploadsAdded$.subscribe(function(n){e.allTracks$.next([].concat(t(e.allTracks$.value),t(e.onlyValidUploads(n))))}),this.album){var n=Object.assign(Object.assign({},this.album),{tags:this.album.tags.map(function(t){return t.name}),genres:this.album.genres.map(function(t){return t.display_name||t.name})});this.form.patchValue(n)}else this.artist?this.form.get("artists").setValue([this.artist]):this.currentUser.canAttachMusicToAnyArtist()||this.form.get("artists").setValue([this.currentUser.get("artists")[0]||this.currentUser.artistPlaceholder()])}},{key:"onlyValidUploads",value:function(t){return t.filter(function(t){return!t.error$.value})}},{key:"reorderTracks",value:function(t){var e=this.allTracks$.value;(0,ie.bA)(e,t.previousIndex,t.currentIndex),this.allTracks$.next(e)}},{key:"submit",value:function(){var t=this;if(this.trackForms.some(function(t){return t.isUploading()}))this.toast.open("Some tracks are still uploading or failed to upload.");else{this.loading$.next(!0);var e=Object.assign(Object.assign({},this.form.value),{tracks:this.trackForms.map(function(t){return t.getPayload()})});e.artists=e.artists.map(function(t){return"number"!=typeof t?t.id:t}),(this.album?this.albums.update(this.album.id,e):this.albums.create(e)).pipe((0,p.x)(function(){return t.loading$.next(!1)})).subscribe(function(e){t.form.markAsPristine(),t.trackForms.forEach(function(t){return t.form.markAsPristine()}),t.toast.open("Album saved."),t.uploadQueue.reset(),t.saved.emit(e.album)},function(e){t.errors=e.errors,(0,le.f)(t.errors,"track-form"),t.cd.markForCheck()})}}},{key:"maybeCancel",value:function(){var t=this;this.confirmCancel?this.modal.show(At.z,{title:"Delete Album",body:"Are you sure you want to cancel all uploads and delete this album?",ok:"Delete"}).beforeClosed().subscribe(function(e){e&&(t.form.reset(),t.uploadQueue.reset(),t.canceled.emit())}):this.canceled.emit()}},{key:"uploadFiles",value:function(t){var e=this;this.uploadQueue.start(t,{uri:"uploads",httpParams:{autoMatchAlbum:!1,diskPrefix:"track_media",disk:"public"},validator:this.audioValidator}).subscribe(function(t){var n=e.uploadQueue.find(t.queueItemId),i=e.trackForms.find(function(e){var n;return(null===(n=e.uploadQueueItem)||void 0===n?void 0:n.id)===t.queueItemId}).form;e.waveform.generate(n.uploadedFile.native).then(function(t){i.patchValue({waveData:t}),n.finishProcessing()}),i.markAsDirty()},function(){return e.toast.open("Could not upload tracks.")})}},{key:"trackRemoved",value:function(t){var e=this.allTracks$.value.filter(function(e){return e.id!==t.id});this.allTracks$.next(e)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(g.Y36(h.qu),g.Y36(x.A),g.Y36(Tt.R),g.Y36(g.sBO),g.Y36(b.z),g.Y36(Ct.u),g.Y36(bt.F),g.Y36(he),g.Y36(v.Z),g.Y36(J.o),g.Y36(l.F0),g.Y36(ve.qQ))},e.\u0275cmp=g.Xpm({type:e,selectors:[["album-form"]],viewQuery:function(t,e){var n;(1&t&&g.Gf(mn,5),2&t)&&(g.iGM(n=g.CRH())&&(e.trackForms=n))},inputs:{album:"album",artist:"artist",confirmCancel:"confirmCancel"},outputs:{canceled:"canceled",saved:"saved"},decls:42,vars:20,consts:[[3,"formGroup","ngSubmit"],[1,"main-info-fields"],[1,"left-column"],["formControlName","image","diskPrefix","album"],["mat-flat-button","","color","accent","type","button","trans","",1,"upload-tracks-button",3,"uploadButton","filesSelected"],[1,"text-fields-container","many-inputs"],[1,"input-container"],["for","album-form-name","trans",""],["type","text","id","album-form-name","formControlName","name","required","",3,"readOnly"],["class","error",4,"ngIf"],["for","album-form-release_date","trans",""],["type","date","placeholder","YYYY-MM-DD","id","album-form-release_date","formControlName","release_date","required",""],["id","album-form-artists","formControlName","artists",3,"error"],["for","album-form-description","trans",""],["type","text","id","album-form-description","formControlName","description","minlength","10","maxlength","250","rows","5"],["for","album-form-genres","trans",""],["placeholder","+Add genre","id","album-form-genres","formControlName","genres",3,"suggestFn"],["for","album-form-tags","trans",""],["placeholder","+Add tag","id","album-form-tags","formControlName","tags",3,"suggestFn"],["class","input-container",4,"ngIf"],["type","submit","mat-raised-button","","color","accent","trans","",3,"disabled"],["type","button","mat-button","","trans","",3,"click"],["cdkDropList","",1,"track-list","unstyled-list",3,"cdkDropListDropped"],["class","track-list-item","cdkDrag","",4,"ngFor","ngForOf","ngForTrackBy"],[1,"error"],["for","album-spotify-id","trans",""],["type","text","id","album-spotify-id","formControlName","spotify_id","minlength","22","maxlength","22"],["cdkDrag","",1,"track-list-item"],[3,"albumForm","track","number","canceled",4,"ngIf"],[3,"albumForm","uploadQueueItem","number","canceled",4,"ngIf"],[3,"albumForm","track","number","canceled"],["mat-icon-button","","cdkDragHandle","","type","button"],["svgIcon","drag-handle"],[3,"albumForm","uploadQueueItem","number","canceled"]],template:function(t,e){1&t&&(g.TgZ(0,"form",0),g.NdJ("ngSubmit",function(){return e.submit()}),g.TgZ(1,"div",1),g.TgZ(2,"div",2),g._UZ(3,"upload-image-control",3),g.TgZ(4,"button",4),g.NdJ("filesSelected",function(t){return e.uploadFiles(t)}),g._uU(5,"Upload Tracks"),g.qZA(),g.qZA(),g.TgZ(6,"div",5),g.TgZ(7,"div",6),g.TgZ(8,"label",7),g._uU(9,"Name"),g.qZA(),g._UZ(10,"input",8),g.YNc(11,gn,2,1,"div",9),g.qZA(),g.TgZ(12,"div",6),g.TgZ(13,"label",10),g._uU(14,"Release Date"),g.qZA(),g._UZ(15,"input",11),g.YNc(16,fn,2,1,"div",9),g.qZA(),g._UZ(17,"track-artist-control",12),g.TgZ(18,"div",6),g.TgZ(19,"label",13),g._uU(20,"Description"),g.qZA(),g._UZ(21,"textarea",14),g.YNc(22,hn,2,1,"div",9),g.qZA(),g.TgZ(23,"div",6),g.TgZ(24,"label",15),g._uU(25,"Genres"),g.qZA(),g._UZ(26,"chip-input",16),g.YNc(27,vn,2,1,"div",9),g.qZA(),g.TgZ(28,"div",6),g.TgZ(29,"label",17),g._uU(30,"Tags"),g.qZA(),g._UZ(31,"chip-input",18),g.YNc(32,bn,2,1,"div",9),g.qZA(),g.YNc(33,Zn,4,0,"div",19),g.TgZ(34,"button",20),g.ALo(35,"async"),g._uU(36,"Save"),g.qZA(),g.TgZ(37,"button",21),g.NdJ("click",function(){return e.maybeCancel()}),g._uU(38,"Cancel"),g.qZA(),g.qZA(),g.qZA(),g.qZA(),g.TgZ(39,"ul",22),g.NdJ("cdkDropListDropped",function(t){return e.reorderTracks(t)}),g.YNc(40,kn,3,2,"li",23),g.ALo(41,"async"),g.qZA()),2&t&&(g.Q6J("formGroup",e.form),g.xp6(4),g.Q6J("uploadButton",e.uploadButtonConfig),g.xp6(6),g.Q6J("readOnly",e.album&&!e.currentUser.hasPermissions(g.DdM(19,_n))),g.xp6(1),g.Q6J("ngIf",e.errors.name),g.xp6(5),g.Q6J("ngIf",e.errors.release_date),g.xp6(1),g.Q6J("error",e.errors.artists),g.xp6(5),g.Q6J("ngIf",e.errors.description),g.xp6(4),g.Q6J("suggestFn",e.suggestGenreFn),g.xp6(1),g.Q6J("ngIf",e.errors.genres),g.xp6(4),g.Q6J("suggestFn",e.suggestTagFn),g.xp6(1),g.Q6J("ngIf",e.errors.tags),g.xp6(1),g.Q6J("ngIf",e.insideAdmin&&e.settings.get("spotify_is_setup")),g.xp6(1),g.Q6J("disabled",g.lcZ(35,15,e.loading$)),g.xp6(6),g.Q6J("ngForOf",g.lcZ(41,17,e.allTracks$))("ngForTrackBy",e.trackByFn))},directives:[h._Y,h.JL,h.sg,_.V,h.JJ,h.u,A.lW,k.P,C.c,h.Fj,h.Q7,u.O5,Te,h.wO,h.nD,yt.S,ie.Wj,u.sg,ie.Zt,mn,ie.Bh,q.Hw],pipes:[u.Ov],styles:["[_nghost-%COMP%]{display:block;padding:25px}.main-info-fields[_ngcontent-%COMP%]{display:flex}.text-fields-container[_ngcontent-%COMP%]{flex:1 1 auto;margin-left:20px}.track-list[_ngcontent-%COMP%]{margin-top:30px;padding:0 15px}.track-list-item[_ngcontent-%COMP%]:not(.cdk-drag-preview){border-bottom:1px solid var(--be-divider-lighter);padding-bottom:15px;margin-bottom:15px}.upload-tracks-button[_ngcontent-%COMP%]{margin-top:15px;width:100%;line-height:40px}@media only screen and (max-width: 768px){[_nghost-%COMP%]{padding:10px}.track-list[_ngcontent-%COMP%]{padding:0}.main-info-fields[_ngcontent-%COMP%]{display:block}.left-column[_ngcontent-%COMP%]{max-width:220px;margin:auto auto 25px}.text-fields-container[_ngcontent-%COMP%]{margin-left:0}}"],changeDetection:0}),e}(),qn=function(){var t=function(){function t(e,n,i,a){s(this,t),this.route=e,this.router=n,this.settings=i,this.urls=a}return c(t,[{key:"ngOnInit",value:function(){var t=this;this.route.data.subscribe(function(e){e.api&&(t.album=e.api.album)}),this.route.queryParams.subscribe(function(e){e.artist&&(t.artist=JSON.parse(atob(e.artist)))})}},{key:"toAlbumsPage",value:function(){this.router.url.includes("admin")?this.router.navigate(this.artist?this.urls.editArtist(this.artist.id,!0):["/admin/albums"]):this.router.navigate(["/"])}},{key:"canDeactivate",value:function(){return!this.albumForm.form.dirty&&!this.albumForm.trackForms.some(function(t){return t.form.dirty})}}]),t}();return t.\u0275fac=function(e){return new(e||t)(g.Y36(l.gz),g.Y36(l.F0),g.Y36(v.Z),g.Y36(Zt.J))},t.\u0275cmp=g.Xpm({type:t,selectors:[["crupdate-album-page"]],viewQuery:function(t,e){var n;(1&t&&g.Gf(An,7),2&t)&&(g.iGM(n=g.CRH())&&(e.albumForm=n.first))},features:[g._Bn([x.A])],decls:1,vars:3,consts:[[1,"material-panel",3,"album","artist","confirmCancel","canceled","saved"]],template:function(t,e){1&t&&(g.TgZ(0,"album-form",0),g.NdJ("canceled",function(){return e.toAlbumsPage()})("saved",function(){return e.toAlbumsPage()}),g.qZA()),2&t&&g.Q6J("album",e.album)("artist",e.artist)("confirmCancel",!1)},directives:[An],styles:[""],changeDetection:0}),t}(),Cn=function(){var t=function(){function t(e){s(this,t),this.modal=e}return c(t,[{key:"canDeactivate",value:function(t){return!!t.canDeactivate()||this.modal.show(At.z,{title:"Unsaved Changes",body:"You have unsaved changes. Do you want to discard them?",ok:"Discard"}).beforeClosed()}}]),t}();return t.\u0275fac=function(e){return new(e||t)(g.LFG(Ct.u))},t.\u0275prov=g.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),Tn=function(){var t=function(){function t(e,n,i){s(this,t),this.route=e,this.router=n,this.settings=i}return c(t,[{key:"ngOnInit",value:function(){var t=this;this.route.data.subscribe(function(e){e.api&&(t.track=e.api.track)})}},{key:"toTracksPage",value:function(){this.insideAdmin()?this.router.navigate(["/admin/tracks"]):this.router.navigate(["/"])}},{key:"canDeactivate",value:function(){return!this.trackForm.form.dirty}},{key:"insideAdmin",value:function(){return this.router.url.includes("admin")}}]),t}();return t.\u0275fac=function(e){return new(e||t)(g.Y36(l.gz),g.Y36(l.F0),g.Y36(v.Z))},t.\u0275cmp=g.Xpm({type:t,selectors:[["crupdate-track-page"]],viewQuery:function(t,e){var n;(1&t&&g.Gf(mn,7),2&t)&&(g.iGM(n=g.CRH())&&(e.trackForm=n.first))},decls:1,vars:1,consts:[[1,"material-panel",3,"track","canceled","saved"]],template:function(t,e){1&t&&(g.TgZ(0,"track-form",0),g.NdJ("canceled",function(){return e.toTracksPage()})("saved",function(){return e.toTracksPage()}),g.qZA()),2&t&&g.Q6J("track",e.track)},directives:[mn],styles:[""],changeDetection:0}),t}(),wn=r(30189),On=r(83106);function In(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return(0,_t.mG)(this,void 0,void 0,regeneratorRuntime.mark(function n(){var i,a,r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,function(t){return new Promise(function(e){Pn(t.createReader(),e)})}(t);case 2:i=n.sent,n.t0=regeneratorRuntime.keys(i);case 4:if((n.t1=n.t0()).done){n.next=19;break}if(a=n.t1.value,!(r=i[a]).isDirectory){n.next=12;break}return n.next=10,In(r,e);case 10:n.next=17;break;case 12:return n.t2=e,n.next=15,Un(r);case 15:n.t3=n.sent,n.t2.push.call(n.t2,n.t3);case 17:n.next=4;break;case 19:return n.abrupt("return",e);case 20:case"end":return n.stop()}},n)}))}function Pn(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];t.readEntries(function(i){i.length?(n=n.concat(i),Pn(t,e,n)):e(n)})}function Un(t){return new Promise(function(e){t.file(function(n){e(new On.D(n,t.fullPath))})})}var Mn=function(){var t=function(){function t(e){s(this,t),this.el=e,this.disableDropzoneClick=!1,this.disableDropzone=!1,this.uploadConfig={},this.filesDropped=new g.vpe}return c(t,[{key:"ngOnInit",value:function(){var t=this,e=this.el.nativeElement;e.addEventListener("dragenter",function(e){return t.handleDragEnter(e)}),e.addEventListener("dragover",function(e){return t.handleDragOver(e)}),e.addEventListener("dragleave",function(e){return t.handleDragLeave(e)}),e.addEventListener("drop",function(e){return t.handleDrop(e)}),this.disableDropzoneClick||(this.clickButton?this.clickButton.nativeElement:e).addEventListener("click",function(){return t.handleClick()})}},{key:"ngOnDestroy",value:function(){this.removeClassesFromDropzone()}},{key:"handleClick",value:function(){var t=this;this.disableDropzone||(0,oe.r)(this.uploadConfig).then(function(e){t.emitUploadEvent(e)})}},{key:"handleDragEnter",value:function(t){this.dropzoneDisabled(t)||this.el.nativeElement.classList.add("file-over-dropzone")}},{key:"handleDragOver",value:function(t){return t.preventDefault&&t.preventDefault(),t.dataTransfer.dropEffect=this.dropzoneDisabled(t)?"none":"move",!1}},{key:"handleDragLeave",value:function(t){var e=document.elementFromPoint(t.clientX,t.clientY);this.el.nativeElement.contains(e)||this.removeClassesFromDropzone()}},{key:"handleDrop",value:function(t){return(0,_t.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.stopPropagation(),t.preventDefault(),this.removeClassesFromDropzone(),!this.dropzoneDisabled(t)&&t.dataTransfer.items){e.next=2;break}return e.abrupt("return");case 2:if(n=Array.from(t.dataTransfer.items).filter(function(t){return"file"===t.kind}).map(function(t){return t.webkitGetAsEntry()}),e.t0=n.length,!e.t0){e.next=10;break}return e.t1=this,e.next=8,function(t){return(0,_t.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var n,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=[],e.t0=regeneratorRuntime.keys(t);case 2:if((e.t1=e.t0()).done){e.next=20;break}if(i=e.t1.value,!(a=t[i]).isDirectory){e.next=13;break}return e.t2=n,e.next=9,In(a);case 9:e.t3=e.sent,n=e.t2.concat.call(e.t2,e.t3),e.next=18;break;case 13:return e.t4=n,e.next=16,Un(a);case 16:e.t5=e.sent,e.t4.push.call(e.t4,e.t5);case 18:e.next=2;break;case 20:return e.abrupt("return",n);case 21:case"end":return e.stop()}},e)}))}(n);case 8:e.t2=e.sent,e.t1.emitUploadEvent.call(e.t1,e.t2);case 10:case"end":return e.stop()}},e,this)}))}},{key:"emitUploadEvent",value:function(t){this.filesDropped.emit(t)}},{key:"removeClassesFromDropzone",value:function(){this.el.nativeElement.classList.remove("file-over-dropzone")}},{key:"dropzoneDisabled",value:function(t){var e=t.dataTransfer.types.find(function(t){return"files"===t.toLowerCase()});return this.disableDropzone||!e}}]),t}();return t.\u0275fac=function(e){return new(e||t)(g.Y36(g.SBq))},t.\u0275dir=g.lG2({type:t,selectors:[["","fileDropzone",""]],inputs:{disableDropzoneClick:"disableDropzoneClick",disableDropzone:"disableDropzone",clickButton:"clickButton",uploadConfig:["fileDropzone","uploadConfig"]},outputs:{filesDropped:"filesDropped"}}),t}(),Jn=r(67451),Qn=r(26982),Fn=["trackLinkInput"];function Nn(t,e){if(1&t&&(g.TgZ(0,"mat-chip",23),g._uU(1),g.qZA()),2&t){var n=g.oxw();g.xp6(1),g.Oqu(n.media.genres[0].name)}}var Yn=function(){var t=function(){function t(e,n){s(this,t),this.settings=e,this.urls=n}return c(t,[{key:"ngOnInit",value:function(){var t=this;setTimeout(function(){t.trackLinkInput.nativeElement.focus(),t.trackLinkInput.nativeElement.select()})}},{key:"mediaLink",value:function(){return this.isTrack(this.media)?this.urls.track(this.media):this.urls.album(this.media)}},{key:"mediaUrl",value:function(){return this.urls.routerLinkToUrl(this.mediaLink())}},{key:"shareUsing",value:function(t){(0,Qn.u)(t,this.mediaUrl())}},{key:"isTrack",value:function(t){return t.model_type===Jn.l}}]),t}();return t.\u0275fac=function(e){return new(e||t)(g.Y36(v.Z),g.Y36(Zt.J))},t.\u0275cmp=g.Xpm({type:t,selectors:[["uploaded-media-preview"]],viewQuery:function(t,e){var n;(1&t&&g.Gf(Fn,7),2&t)&&(g.iGM(n=g.CRH())&&(e.trackLinkInput=n.first))},hostAttrs:[1,"material-panel"],inputs:{media:"media"},decls:32,vars:14,consts:[[1,"media-image-container"],[3,"media"],["alt","album border image",1,"album-border-image",3,"src"],[1,"middle-column"],[1,"artist-name"],[1,"track-name"],[1,"genre-row"],["class","track-genre",4,"ngIf"],[1,"message"],["trans",""],["trans","",3,"routerLink"],[1,"right-column"],["trans","",1,"title"],[1,"share-icons"],["mat-icon-button","",3,"click"],["alt","facebook-icon",3,"src"],["alt","twitter-icon",3,"src"],["alt","tumblr-icon",3,"src"],["alt","blogger-icon",3,"src"],[1,"track-link-input","input-container"],["for","media-item-link","trans","",1,"hidden"],["id","media-item-link","type","text","readonly","",3,"value","click"],["trackLinkInput",""],[1,"track-genre"]],template:function(t,e){1&t&&(g.TgZ(0,"div",0),g._UZ(1,"media-image",1),g._UZ(2,"img",2),g.qZA(),g.TgZ(3,"div",3),g.TgZ(4,"div",4),g._uU(5),g.qZA(),g.TgZ(6,"div",5),g._uU(7),g.qZA(),g.TgZ(8,"div",6),g.YNc(9,Nn,2,1,"mat-chip",7),g.qZA(),g.TgZ(10,"div",8),g.TgZ(11,"span",9),g._uU(12,"Upload complete."),g.qZA(),g.TgZ(13,"a",10),g._uU(14," View now."),g.qZA(),g.qZA(),g.qZA(),g.TgZ(15,"div",11),g.TgZ(16,"div",12),g._uU(17),g.qZA(),g.TgZ(18,"div",13),g.TgZ(19,"button",14),g.NdJ("click",function(){return e.shareUsing("facebook")}),g._UZ(20,"img",15),g.qZA(),g.TgZ(21,"button",14),g.NdJ("click",function(){return e.shareUsing("twitter")}),g._UZ(22,"img",16),g.qZA(),g.TgZ(23,"button",14),g.NdJ("click",function(){return e.shareUsing("tumblr")}),g._UZ(24,"img",17),g.qZA(),g.TgZ(25,"button",14),g.NdJ("click",function(){return e.shareUsing("blogger")}),g._UZ(26,"img",18),g.qZA(),g.qZA(),g.TgZ(27,"div",19),g.TgZ(28,"label",20),g._uU(29,"Media link"),g.qZA(),g.TgZ(30,"input",21,22),g.NdJ("click",function(t){return t.target.select()}),g.qZA(),g.qZA(),g.qZA()),2&t&&(g.ekj("show-album-border",!e.isTrack(e.media)),g.xp6(1),g.Q6J("media",e.media),g.xp6(1),g.Q6J("src",e.settings.getAssetUrl("images/album-border.png"),g.LSH),g.xp6(3),g.Oqu(e.media.artists[0].name),g.xp6(2),g.Oqu(e.media.name),g.xp6(2),g.Q6J("ngIf",e.media.genres.length),g.xp6(4),g.Q6J("routerLink",e.mediaLink()),g.xp6(4),g.hij("Share your new ",e.isTrack(e.media)?"track":"album",""),g.xp6(3),g.s9C("src",e.settings.getAssetUrl("images/social-icons/facebook.png"),g.LSH),g.xp6(2),g.s9C("src",e.settings.getAssetUrl("images/social-icons/twitter.png"),g.LSH),g.xp6(2),g.s9C("src",e.settings.getAssetUrl("images/social-icons/tumblr.png"),g.LSH),g.xp6(2),g.s9C("src",e.settings.getAssetUrl("images/social-icons/bloggr.png"),g.LSH),g.xp6(4),g.Q6J("value",e.mediaUrl()))},directives:[N.P,u.O5,k.P,l.yS,A.lW,ye.HS],styles:["[_nghost-%COMP%]{display:flex;align-items:center;min-width:800px;max-width:100%}.media-image-container[_ngcontent-%COMP%]{flex-shrink:0;width:130px;height:130px}.media-image-container.show-album-border[_ngcontent-%COMP%]{position:relative;margin:15px 15px 15px 20px}.media-image-container.show-album-border[_ngcontent-%COMP%]   .album-border-image[_ngcontent-%COMP%]{display:block}media-image[_ngcontent-%COMP%]     img{position:relative;z-index:2}.album-border-image[_ngcontent-%COMP%]{display:none;position:absolute;width:160px;height:160px;top:-15px;left:-15px;z-index:1}.middle-column[_ngcontent-%COMP%], .right-column[_ngcontent-%COMP%]{flex:1 1 auto}.middle-column[_ngcontent-%COMP%]{padding:0 20px}.artist-name[_ngcontent-%COMP%]{color:var(--be-secondary-text)}.track-name[_ngcontent-%COMP%]{font-weight:500}.genre-row[_ngcontent-%COMP%]{margin:10px 0 20px}.right-column[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{color:var(--be-secondary-text);margin-bottom:5px}.right-column[_ngcontent-%COMP%]   .share-icons[_ngcontent-%COMP%]{margin-bottom:30px}.right-column[_ngcontent-%COMP%]   .mat-icon-button[_ngcontent-%COMP%]{margin-right:5px;width:32px;height:32px;line-height:32px}.right-column[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.input-container[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{height:35px}"],changeDetection:0}),t}(),$n=["clickMatButton"];function Dn(t,e){if(1&t){var n=g.EpF();g.TgZ(0,"div",10),g.TgZ(1,"mat-slide-toggle",11),g.NdJ("change",function(t){return g.CHM(n),g.oxw().createAlbum$.next(t.checked)}),g._uU(2,"Make an album when multiple files are selected"),g.qZA(),g.qZA()}}function Sn(t,e){if(1&t&&(g.TgZ(0,"div",12),g.TgZ(1,"span"),g._uU(2),g.TgZ(3,"a",13),g._uU(4,"Pro accounts"),g.qZA(),g._uU(5," to get more time and access to advanced features."),g.qZA(),g.qZA()),2&t){var n=e.ngIf;g.xp6(2),g.hij("You have ",n," minutes left. Try ")}}function Ln(t,e){if(1&t){var n=g.EpF();g.TgZ(0,"album-form",18),g.NdJ("saved",function(t){return g.CHM(n),g.oxw(3).addSavedMedia(t)}),g.qZA()}}function En(t,e){if(1&t){var n=g.EpF();g.TgZ(0,"div",20),g.TgZ(1,"track-form",21),g.NdJ("saved",function(t){return g.CHM(n),g.oxw(5).addSavedMedia(t)}),g.qZA(),g.qZA()}if(2&t){var i=e.$implicit;g.xp6(1),g.Q6J("uploadQueueItem",i)}}function zn(t,e){if(1&t&&(g.ynx(0),g.YNc(1,En,2,1,"div",19),g.BQk()),2&t){var n=g.oxw(3).ngIf,i=g.oxw();g.xp6(1),g.Q6J("ngForOf",n)("ngForTrackBy",i.trackByFn)}}function Bn(t,e){if(1&t&&(g.YNc(0,zn,2,2,"ng-container",15),g.ALo(1,"async")),2&t){var n=g.oxw(3);g.Q6J("ngIf",g.lcZ(1,1,n.errors$))}}function Gn(t,e){if(1&t&&(g.ynx(0),g.YNc(1,Ln,1,0,"album-form",16),g.ALo(2,"async"),g.YNc(3,Bn,2,3,"ng-template",null,17,g.W1O),g.BQk()),2&t){var n=g.MAs(4),i=g.oxw(2);g.xp6(1),g.Q6J("ngIf",g.lcZ(2,2,i.createAlbum$))("ngIfElse",n)}}function Vn(t,e){if(1&t&&(g.TgZ(0,"div",14),g.YNc(1,Gn,5,4,"ng-container",15),g.qZA()),2&t){var n=e.ngIf;g.xp6(1),g.Q6J("ngIf",n.length)}}function jn(t,e){1&t&&g._UZ(0,"uploaded-media-preview",22),2&t&&g.Q6J("media",e.$implicit)}var Hn=[{path:"",redirectTo:"/",pathMatch:"full"},{path:"requests",component:ft},{path:"requests/verify-artist",component:ct},{path:"requests/become-artist",component:ct},{path:"requests/claim-artist",component:ct},{path:"requests/:requestId/request-submitted",component:lt},{path:"upload",component:function(){var e=function(){function e(t,n,i,a,r,o,u,c){s(this,e),this.track=t,this.currentUser=n,this.uploadQueue=i,this.settings=a,this.tracks=r,this.toast=o,this.audioValidator=u,this.waveGenerator=c,this.errors$=new d.X({}),this.uploadConfig={types:[se.j.video,se.j.audio],multiple:!0},this.savedMedia$=new d.X([]),this.createAlbum$=new d.X(!1),this.trackByFn=function(t,e){return e.id}}return c(e,[{key:"uploadTracks",value:function(t){var e=this;this.uploadQueue.start(t,{uri:"uploads",httpParams:{diskPrefix:"track_media",disk:"public"},validator:this.audioValidator,willProcessFiles:!0,autoMatchAlbum:!this.createAlbum$.value}).subscribe(function(t){var n=e.uploadQueue.find(t.queueItemId);e.waveGenerator.generate(n.uploadedFile.native).then(function(t){n.customData={waveData:t},n.finishProcessing()}),e.albumForm&&!e.albumForm.form.get("name").value&&t.metadata.album_name&&e.albumForm.form.patchValue({name:t.metadata.album_name})})}},{key:"addSavedMedia",value:function(e){this.savedMedia$.next([].concat(t(this.savedMedia$.value),[e]))}}]),e}();return e.\u0275fac=function(t){return new(t||e)(g.Y36(de.O),g.Y36(wt.I),g.Y36(x.A),g.Y36(v.Z),g.Y36(de.O),g.Y36(bt.F),g.Y36(he),g.Y36(ve.qQ))},e.\u0275cmp=g.Xpm({type:e,selectors:[["upload-page"]],viewQuery:function(t,e){var n;(1&t&&(g.Gf($n,7,g.SBq),g.Gf(An,5),g.Gf(mn,5)),2&t)&&(g.iGM(n=g.CRH())&&(e.clickButton=n.first),g.iGM(n=g.CRH())&&(e.albumForm=n.first),g.iGM(n=g.CRH())&&(e.trackForms=n))},features:[g._Bn([x.A])],decls:14,vars:10,consts:[[1,"dropzone",3,"fileDropzone","clickButton","filesDropped"],["trans","",1,"title"],[1,"action-button"],["mat-flat-button","","color","accent","type","button","trans","",1,"upload-button"],["clickMatButton",""],["class","setting-toggle-container",4,"ngIf"],["class","minutes-container",4,"ngIf"],["class","track-upload-queue",4,"ngIf"],[1,"saved-tracks"],[3,"media",4,"ngFor","ngForOf"],[1,"setting-toggle-container"],["trans","",3,"change"],[1,"minutes-container"],["routerLink","/billing/upgrade","target","_blank",1,"hover-underline"],[1,"track-upload-queue"],[4,"ngIf"],["class","material-panel",3,"saved",4,"ngIf","ngIfElse"],["createTracks",""],[1,"material-panel",3,"saved"],["class","track-panel material-panel",4,"ngFor","ngForOf","ngForTrackBy"],[1,"track-panel","material-panel"],[3,"uploadQueueItem","saved"],[3,"media"]],template:function(t,e){1&t&&(g.TgZ(0,"div",0),g.NdJ("filesDropped",function(t){return e.uploadTracks(t)}),g.TgZ(1,"div",1),g._uU(2,"Drag and drop your tracks, videos & albums here."),g.qZA(),g.TgZ(3,"div",2),g.TgZ(4,"button",3,4),g._uU(6," or choose files to upload "),g.qZA(),g.qZA(),g.YNc(7,Dn,3,0,"div",5),g.qZA(),g.YNc(8,Sn,6,1,"div",6),g.YNc(9,Vn,2,1,"div",7),g.ALo(10,"async"),g.TgZ(11,"div",8),g.YNc(12,jn,1,1,"uploaded-media-preview",9),g.ALo(13,"async"),g.qZA()),2&t&&(g.Q6J("fileDropzone",e.uploadConfig)("clickButton",e.clickButton),g.xp6(7),g.Q6J("ngIf",e.uploadQueue.isEmpty()),g.xp6(1),g.Q6J("ngIf",e.currentUser.getRestrictionValue("tracks.create","minutes")),g.xp6(1),g.Q6J("ngIf",g.lcZ(10,6,e.uploadQueue.uploads$)),g.xp6(3),g.Q6J("ngForOf",g.lcZ(13,8,e.savedMedia$)))},directives:[Mn,k.P,A.lW,u.O5,u.sg,Lt.Rr,l.yS,An,mn,Yn],pipes:[u.Ov],styles:["admin[_nghost-%COMP%], admin   [_nghost-%COMP%]{min-height:calc(100vh - 120px)}[_nghost-%COMP%]{display:flex;align-items:center;justify-content:center;flex-direction:column;min-height:100%}.dropzone[_ngcontent-%COMP%]{background:var(--be-background);padding:50px;border-radius:4px;text-align:center;border:1px solid var(--be-divider-default);min-width:520px;max-width:90%}.dropzone[_ngcontent-%COMP%]   .action-button[_ngcontent-%COMP%]{margin-top:20px}.dropzone[_ngcontent-%COMP%]   .setting-toggle-container[_ngcontent-%COMP%]{margin-top:20px;padding-top:20px;border-top:1px solid var(--be-divider-lighter);font-size:1.3rem}.dropzone[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:1.8rem}.dropzone[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .dropzone[_ngcontent-%COMP%]   .setting-toggle-container[_ngcontent-%COMP%]{margin-bottom:0}.dropzone.file-over-dropzone[_ngcontent-%COMP%]{border-color:var(--be-accent-default);background-color:var(--be-accent-emphasis)}.create-artists-toggle[_ngcontent-%COMP%]{margin-top:20px;min-width:520px;text-align:center}.minutes-container[_ngcontent-%COMP%]{color:var(--be-secondary-text);font-size:1.5rem;margin-top:20px}.minutes-container[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--be-accent-default)}.track-upload-queue[_ngcontent-%COMP%]{width:100%;margin-top:40px}.track-panel[_ngcontent-%COMP%]{margin-bottom:20px;padding:20px 25px}uploaded-media-preview[_ngcontent-%COMP%]{margin-bottom:15px}"],changeDetection:0}),e}()},{path:"artists/new",component:Kt},{path:"artists/:id/edit",component:Kt,resolve:{api:ne},canDeactivate:[Cn]},{path:"albums/:id/edit",component:qn,resolve:{api:function(){var t=function(){function t(e,n){s(this,t),this.albums=e,this.router=n}return c(t,[{key:"resolve",value:function(t,e){var n=this,i=+t.paramMap.get("id");return this.albums.get(i,{with:["tags","genres","artists","fullTracks"],albumsPerPage:50,forEditing:!0}).pipe((0,U.K)(function(){return n.router.navigate(["/"]),ee.E}),(0,te.zg)(function(t){return t.album?(0,w.of)(t):(n.router.navigate(["/"]),ee.E)}))}}]),t}();return t.\u0275fac=function(e){return new(e||t)(g.LFG(Tt.R),g.LFG(l.F0))},t.\u0275prov=g.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t}()},canDeactivate:[Cn]},{path:"albums/new",component:qn,canDeactivate:[Cn]},{path:"tracks/:id/edit",component:Tn,resolve:{api:wn.T},canDeactivate:[Cn]},{path:"tracks/new",component:Tn,canDeactivate:[Cn]}],Rn=function(){var t=function t(){s(this,t)};return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=g.oAB({type:t}),t.\u0275inj=g.cJS({imports:[[l.Bz.forChild(Hn)],l.Bz]}),t}(),Xn=r(18295),Wn=r(49866),Kn=r(36702),ti=r(66705),ei=r(98097),ni=r(39079),ii=r(43389),ai=function(){var t=function t(){s(this,t)};return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=g.oAB({type:t}),t.\u0275inj=g.cJS({imports:[[u.ez,Q.Tx,ni.M,Wn.N,h.u5,h.UX,q.Ps,ii.p,A.ot]]}),t}(),ri=r(87738),oi=r(40557),si=r(55688),ui=r(22449),ci=function(){var t=function t(){s(this,t)};return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=g.oAB({type:t}),t.\u0275inj=g.cJS({imports:[[u.ez,l.Bz,ni.M,ai,q.Ps,Ie.Cv,Wn.N,ti.z,h.UX,h.u5,A.ot,ri.G,ye.Hi,Lt.rP,Ut.AV,Kn.a,ie._t,xe.Bb,Q.Tx,ii.p,ui.W]]}),t}(),li=r(22213),di=function(){var t=function t(){s(this,t)};return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=g.oAB({type:t}),t.\u0275inj=g.cJS({imports:[[u.ez,Rn,ci,h.UX,h.u5,ai,Wn.N,Xn.l,A.ot,q.Ps,Lt.rP,ti.z,Kn.a,ei.X,si.s,ii.p,li.Is,xt.Nh,ri.G,oi.x,ni.M,Ut.AV]]}),t}()}}])}();
//# sourceMappingURL=170-es5.53ac80afaaa22b9135df.js.map